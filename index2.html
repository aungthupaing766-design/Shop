<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <title>POS á€…á€”á€…á€º - á€…á€®á€™á€¶á€á€”á€·á€ºá€á€½á€²á€™á€¾á€¯</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#52B788">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Myanmar:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>

        /* ==================== Global & Theme Settings ==================== */
        :root {
            /* Light Theme (Default) */
            --primary: #52B788; /* Green for POS system */
            --secondary: #35795C;
            --accent: #E8F5E9;
            --background: #f5f5f5;
            --surface: #ffffff;
            --text: #333;
            --text-light: #666;
            --border: #e0e0e0;
            --input-bg: #f9f9f9;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 10px rgba(0,0,0,0.15);
            --danger: #C62828;
            --success: #2E7D32;
            --info: #0277bd;
            --dark-nav: #264653;
            --nav-text: white;

            /* Custom Cart Summary UI/UX (Based on 1000008464.jpg) */
            --cart-summary-bg: #f9f4e8; /* Light beige background */
            --cart-summary-text: #4a4a4a;
            --cart-summary-border: #d3ccc0;
            --cart-summary-total-color: #333;
            --cart-summary-line: #d3ccc0;
            --warning: #FFC107; /* Added for stock alert */
        }

        /* Dark Theme Styles */
        body.dark-theme {
            --primary: #80CBC4;
            --secondary: #4DB6AC;
            --accent: #1D5C63;
            --background: #121212;
            --surface: #1E1E1E;
            --text: #E0E0E0;
            --text-light: #B0B0B0;
            --border: #333;
            --input-bg: #282828;
            --dark-nav: #000000;
            --nav-text: #80CBC4;

            /* Dark Cart UI Colors */
            --cart-summary-bg: #2b2b2b;
            --cart-summary-text: #E0E0E0;
            --cart-summary-border: #444;
            --cart-summary-total-color: #EEEEEE;
            --cart-summary-line: #444;
            --warning: #FFD54F;
        }

        body {
            font-family: 'Noto Sans Myanmar', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background);
            color: var(--text);
            line-height: 1.5;
            font-size: 15px;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            width: 100%;
        }

        /* Tab Navigation */
        .nav-tabs {
            display: flex;
            background-color: var(--dark-nav);
            color: var(--nav-text);
            box-shadow: var(--shadow-md);
            position: relative;
        }
        .nav-tab {
            padding: 15px 20px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s, color 0.3s;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        .nav-tab.active { background-color: var(--primary); color: var(--surface); }

        /* Cart Icon and Counter in Navigation */
        .cart-nav-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
            color: var(--nav-text);
            cursor: pointer;
        }

        .cart-count {
            position: absolute;
            top: -5px;
            right: -10px;
            background-color: var(--danger); /* Red badge */
            color: white;
            border-radius: 50%;
            padding: 2px 7px;
            font-size: 12px;
            line-height: 1;
            font-weight: bold;
            display: none; /* Initially hidden */
            min-width: 12px;
            text-align: center;
            box-shadow: var(--shadow-sm);
        }

        .content-area { display: flex; flex-grow: 1; padding: 20px; background-color: var(--surface); transition: background-color 0.3s; }
        .tab-content { display: none; width: 100%; }
        .tab-content.active { display: block; }

        /* Buttons and Controls (Improved) */
        .btn { padding: 10px 15px; border: none; border-radius: 6px; cursor: pointer; font-family: inherit; font-weight: bold; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 15px; }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn-add-new { background: var(--success); color: var(--surface); }
        .btn-save { background: var(--secondary); color: var(--surface); }
        .btn-print { background: var(--info); color: var(--surface); }
        .btn-danger { background: var(--danger); color: var(--surface); }
        .btn-clear { background: var(--danger); color: var(--surface); }
        .btn-quick-cash { background: var(--accent); color: var(--text); padding: 8px 12px; font-size: 14px; } /* New Quick Cash style */
        .btn-quick-cash:hover { background: var(--primary); color: var(--surface); }
        .action-icon { background: none; border: none; cursor: pointer; font-size: 18px; margin: 0 5px; transition: color 0.2s; color: var(--text-light); }
        .action-icon:hover { color: var(--primary); }

        /* Forms and Inputs */
        .controls-group { display: flex; gap: 10px; margin-bottom: 20px; align-items: center; flex-wrap: wrap; }
        .controls-group label { font-weight: bold; color: var(--text-light); white-space: nowrap; }
        .controls-group input, .controls-group select, .form-input, .form-select, .form-textarea {
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-family: inherit;
            transition: border-color 0.2s, background-color 0.3s;
            background-color: var(--input-bg);
            color: var(--text);
            box-sizing: border-box;
        }
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; margin-bottom: 5px; font-weight: bold; color: var(--text); }
        .form-input, .form-select, .form-textarea { width: 100%; }
        .form-textarea { resize: vertical; }

        /* ==================== POS Layout (REVISED CART WIDTH) ==================== */
        .pos-layout { display: flex; width: 100%; gap: 20px; position: relative; }
        .pos-product-list { flex: 3; display: flex; flex-direction: column; }
        /* Sales Cart á€€á€­á€¯ á€¡á€œá€»á€¬á€¸ á€€á€»á€‰á€ºá€¸á€•á€±á€¸á€‘á€¬á€¸á€á€Šá€º */
        .pos-cart-section {
            flex: 1.2; /* á€•á€­á€¯á€•á€¼á€®á€¸á€€á€»á€‰á€ºá€¸á€¡á€±á€¬á€„á€ºá€œá€¯á€•á€ºá€‘á€¬á€¸á€á€Šá€º */
            min-width: 280px; /* á€¡á€”á€Šá€ºá€¸á€†á€¯á€¶á€¸ width á€€á€­á€¯ 280px á€á€­á€¯á€· á€•á€¼á€±á€¬á€„á€ºá€¸á€‘á€¬á€¸á€á€Šá€º */
            padding: 15px;
            background-color: var(--surface);
            border-radius: 8px;
            box-shadow: var(--shadow-md);
            position: relative;
        }

        /* Enhanced Product Grid UI/UX - Improved Card Design */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 15px;
            overflow-y: auto;
            padding-right: 5px;
            flex-grow: 1;
            max-height: 80vh;
        }
        .product-item {
            background: var(--surface);
            border-radius: 12px; /* Rounded corners */
            box-shadow: 0 3px 10px rgba(0,0,0,0.08); /* Enhanced shadow */
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            padding: 0;
            border: 1px solid var(--border);
            height: 180px; /* Fixed height for consistency */
        }
        .product-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            border-color: var(--primary);
        }
        .product-item img {
            width: 100%;
            height: 100px; /* Slightly larger image area */
            object-fit: cover;
            border-radius: 11px 11px 0 0;
            margin-bottom: 0;
        }
        
        /* IMAGE á€•á€¯á€¶á€™á€›á€¾á€­á€œá€»á€¾á€„á€º á€”á€±á€›á€¬á€™á€šá€°á€…á€±á€›á€”á€º */
        .product-item img.hidden { 
             display: none !important; 
             height: 0 !important;
        }

        .product-info {
            padding: 10px 12px 40px 12px; /* More padding for better spacing */
            width: 100%;
            box-sizing: border-box;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        /* Image á€™á€•á€«á€á€±á€¬ Product Item á€¡á€á€½á€€á€º name á€€á€­á€¯ á€¡á€•á€±á€«á€ºá€á€½á€„á€ºá€‘á€¬á€¸á€•á€¼á€®á€¸ á€”á€±á€›á€¬á€šá€°á€…á€±á€›á€”á€º */
        .product-item.no-image {
             justify-content: flex-end; /* price á€€á€­á€¯ á€¡á€±á€¬á€€á€ºá€†á€¯á€¶á€¸á€•á€­á€¯á€·á€›á€”á€º */
             padding-top: 10px; /* á€¡á€•á€±á€«á€ºá€˜á€€á€º á€”á€±á€›á€¬á€šá€°á€™á€¾á€¯ */
        }
        .product-item.no-image .product-name { 
            margin-top: 0; 
            padding: 0 12px;
            height: auto; /* Name á€”á€±á€›á€¬á€€á€­á€¯ á€œá€­á€¯á€á€œá€±á€¬á€€á€º á€šá€°á€…á€±á€›á€”á€º */
            -webkit-line-clamp: 3;
            flex-grow: 1;
            display: flex; /* á€¡á€•á€±á€«á€ºá€†á€¯á€¶á€¸á€€á€­á€¯ á€á€½á€”á€ºá€¸á€•á€­á€¯á€·á€›á€”á€º */
            align-items: flex-start;
        } 

        .product-name {
            font-weight: bold;
            color: var(--text);
            font-size: 14px;
            text-align: left;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2; /* 2 lines max */
            -webkit-box-orient: vertical;
            line-height: 1.2;
            height: 2.4em; /* For 2 lines of text */
            margin-bottom: 5px;
            /* For image mode */
            padding: 10px 12px 0 12px;
        }
        /* Enhanced Price Tag */
        .product-price {
            position: absolute;
            bottom: 10px;
            left: 12px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-size: 14px;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* Enhanced Cart Items with Drag & Drop - Smaller and without Images */
        .cart-items {
            max-height: 35vh;
            overflow-y: auto;
            margin-bottom: 15px;
            background: var(--input-bg);
            border-radius: 6px;
            padding: 5px;
            border: 1px solid var(--border);
            min-height: 50px;
        }

        /* Cart Item Row - Smaller without Images */
        .cart-item {
            display: flex;
            align-items: center;
            padding: 8px 5px; /* Reduced padding */
            border-bottom: 1px dotted var(--cart-summary-line);
            font-size: 12px; /* Smaller font */
            transition: all 0.2s ease;
            background-color: var(--surface);
            border-radius: 6px;
            margin-bottom: 5px;
            cursor: grab;
            position: relative;
        }
        .cart-item:hover {
            background-color: var(--accent);
            transform: translateX(3px);
        }
        .cart-item:last-child { border-bottom: none; margin-bottom: 0; }
        .cart-item.dragging {
            opacity: 0.5;
            transform: scale(0.95);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .cart-item.drag-over {
            border-top: 2px solid var(--primary);
        }

        .cart-item-details {
            flex: 1;
            margin-right: 5px;
            overflow: hidden;
            min-width: 0; /* Prevent overflow */
        }
        
        /* ğŸ’¡ á€á€±á€¬á€„á€ºá€¸á€†á€­á€¯á€á€»á€€á€ºá€¡á€› á€•á€¼á€„á€ºá€†á€„á€ºá€á€¼á€„á€ºá€¸ - á€•á€­á€¯á€™á€¼á€„á€ºá€á€¬á€á€±á€¬ á€…á€¬á€œá€¯á€¶á€¸á€¡á€€á€¼á€®á€¸/á€¡á€‘á€° */
        .cart-item-name {
            font-weight: bold;
            color: var(--text);
            font-size: 14px; /* á€•á€­á€¯á€€á€¼á€®á€¸á€œá€¬á€á€±á€¬ á€…á€¬á€œá€¯á€¶á€¸ */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding-bottom: 2px; /* á€¡á€±á€¬á€€á€ºá€˜á€€á€ºá€”á€±á€›á€¬ á€”á€Šá€ºá€¸á€”á€Šá€ºá€¸á€•á€±á€¸á€‘á€¬á€¸á€á€Šá€º */
        }
        .cart-item-price-qnty {
            font-size: 12px; /* á€¡á€±á€¬á€€á€ºá€€ á€…á€¬á€œá€¯á€¶á€¸á€¡á€á€±á€¸ */
            color: var(--text-light);
            display: block;
            margin-top: 0;
        }
        /* Quantity Controls - Smaller */
        .qty-controls {
            display: flex;
            align-items: center;
            gap: 3px; /* Smaller gap */
            width: 75px; /* Smaller width */
            justify-content: space-between;
            flex-shrink: 0;
            background: var(--surface);
            border-radius: 4px;
            border: 1px solid var(--border);
            padding: 1px 0;
        }
        .qty-btn {
            width: 18px; /* Smaller buttons */
            height: 18px;
            border-radius: 3px;
            font-size: 12px; /* Smaller font */
            background: none;
            color: var(--primary);
            border: none;
            cursor: pointer;
            padding: 0;
            line-height: 1;
            font-weight: bold;
            flex-shrink: 0;
            transition: color 0.1s;
        }
        .qty-btn:hover {
            color: var(--secondary);
        }
        .item-qty {
            font-weight: bold;
            font-size: 12px; /* Smaller font */
            color: var(--text);
            flex-grow: 1;
            text-align: center;
        }
        /* Item Total - Smaller */
        .cart-item-total {
            width: 55px; /* Smaller width */
            text-align: right;
            font-weight: bold;
            color: var(--danger);
            font-size: 14px; /* á€•á€­á€¯á€™á€¼á€„á€ºá€á€¬á€…á€±á€›á€”á€º */
            flex-shrink: 0;
        }

        /* Enhanced Delete Icon - Smaller */
        .cart-delete-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px; /* Smaller icon */
            color: var(--danger);
            margin-left: 3px;
            padding: 0;
            line-height: 1;
            flex-shrink: 0;
            transition: opacity 0.2s;
        }
        .cart-delete-btn:hover {
            opacity: 0.7;
        }

        /* Drag Handle for Cart Items - Smaller */
        .drag-handle {
            cursor: grab;
            color: var(--text-light);
            margin-right: 5px;
            font-size: 12px; /* Smaller font */
            transition: color 0.2s;
        }
        .drag-handle:hover {
            color: var(--primary);
        }

        .action-buttons { display: flex; gap: 10px; margin-top: 20px; }
        .action-buttons .btn { flex-grow: 1; padding: 12px 10px; font-size: 15px; }

        /* **Cart Summary UI/UX (Based on 1000008464.jpg)** */
        .cart-summary {
            margin-top: 15px;
            padding: 15px;
            background-color: var(--cart-summary-bg);
            border-radius: 8px;
            border: 1px solid var(--cart-summary-border);
            color: var(--cart-summary-text);
            font-size: 16px;
            box-shadow: var(--shadow-sm);
        }
        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px dotted var(--cart-summary-line);
        }

        .summary-row.total-separator {
            border-bottom: 1px solid var(--cart-summary-line);
            margin-bottom: 5px;
            padding-bottom: 10px;
        }

        .summary-row:last-of-type { border-bottom: none; }

        .summary-row span:first-child { font-weight: normal; font-size: 15px; }
        .summary-row span:last-child { font-weight: normal; font-size: 15px; }

        .total-row {
            font-weight: bold;
            font-size: 20px;
            padding: 8px 0;
            margin-top: 5px;
            border-bottom: 1px solid var(--cart-summary-line);
        }
        .total-row span {
            font-weight: bold !important;
            font-size: 20px !important;
            color: var(--cart-summary-total-color);
        }

        .cash-row, .change-row {
            font-size: 16px;
            padding: 6px 0;
        }
        .cash-row span:last-child, .change-row span:last-child {
            font-weight: bold;
            font-size: 18px;
            color: var(--secondary);
        }

        /* Quick Cash Buttons style */
        .quick-cash-buttons {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            justify-content: space-between;
        }

        /* Discount & Cash Input styles */
        .input-group-controls { display: flex; gap: 10px; padding: 10px 0; border-top: 1px solid var(--border); align-items: center; margin-bottom: 15px; }
        .input-group-controls > div { flex: 1; }
        .input-group-field { display: flex; align-items: center; }
        .input-group-field input {
            flex-grow: 1;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background-color: var(--input-bg);
            color: var(--text);
            font-size: 16px;
            text-align: right;
        }
        .input-group-field span { margin-left: 8px; font-weight: bold; color: var(--text-light); }

        /* ==================== Central Calculator Styles (Removed by request) ==================== */
        /* .calculator-modal { display: none; ... } */

        /* ==================== Dashboard Cards & Table ==================== */
        .summary-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: var(--surface); padding: 20px; border-radius: 10px; box-shadow: var(--shadow-md); border-left: 5px solid var(--primary); transition: all 0.3s; }
        .card-title { font-size: 14px; color: var(--text-light); margin-bottom: 10px; }
        .card-value { font-size: 30px; font-weight: bold; color: var(--text); }

        /* Reports/Dashboard Table */
        .reports-table { width: 100%; border-collapse: collapse; margin-top: 10px; box-shadow: var(--shadow-sm); }
        .reports-table th, .reports-table td { border: 1px solid var(--border); padding: 10px; text-align: left; font-size: 14px; }
        .reports-table th { background-color: var(--accent); color: var(--text); }
        .reports-table tr:nth-child(even) { background-color: var(--input-bg); }
        .reports-summary { display: flex; justify-content: flex-end; gap: 30px; margin-top: 15px; font-size: 16px; font-weight: bold; padding: 10px 0; border-top: 2px solid var(--primary);}
        .reports-summary div { color: var(--danger); }

        /* ==================== Modal/Form UI/UX ==================== */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            padding-top: 50px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .modal.active { opacity: 1; }
        .modal-content {
            background-color: var(--surface);
            margin: 5% auto;
            padding: 30px;
            border-radius: 10px;
            box-shadow: var(--shadow-md);
            width: 90%;
            max-width: 500px;
            transform: translateY(-20px);
            transition: transform 0.3s;
        }
        .modal.active .modal-content { transform: translateY(0); }
        .modal-title { font-size: 24px; font-weight: bold; margin-bottom: 20px; color: var(--primary); border-bottom: 2px solid var(--accent); padding-bottom: 10px;}
        .modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }

        /* Image Upload Section */
        .image-upload-area {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s, background-color 0.3s;
            margin-bottom: 15px;
        }
        .image-upload-area:hover { border-color: var(--primary); background-color: var(--input-bg); }
        .image-preview-container {
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 10px;
            background: var(--input-bg);
            border-radius: 6px;
        }
        .image-preview { max-width: 80px; max-height: 80px; border-radius: 4px; object-fit: cover; }
        .delete-image-btn { background: var(--danger); color: white; border: none; border-radius: 50%; width: 25px; height: 25px; font-size: 14px; cursor: pointer; transition: background-color 0.2s; }
        .delete-image-btn:hover { background: #991C1C; }

        /* ==================== Setting Table Click Item UI/UX Designer ==================== */
        .settings-form h3 { color: var(--primary); border-bottom: 1px solid var(--accent); padding-bottom: 5px; margin-top: 25px;}

        /* Style for Low Stock products in Management Table (REMOVED STOCK LOGIC) */
        .low-stock { /* This class is now unused since stock is removed */ }
        .low-stock td { /* This class is now unused since stock is removed */ }

        /* New CSS for Product Item (when image fails or is missing) */
        .product-management-table img.hidden { display: none !important; }
        /* Ensure the table cell still looks fine when image is hidden */
        .product-management-table td:nth-child(2) { text-align: center; }

        /* ğŸ’¡ á€á€±á€¬á€„á€ºá€¸á€†á€­á€¯á€á€»á€€á€ºá€¡á€› á€•á€¼á€„á€ºá€†á€„á€ºá€á€¼á€„á€ºá€¸: Toast/Message Popup Styles á€€á€­á€¯ á€™á€»á€€á€ºá€”á€¾á€¬á€•á€¼á€„á€º á€¡á€•á€±á€«á€º á€¡á€œá€šá€ºá€á€­á€¯á€· á€›á€½á€¾á€±á€·á€á€¼á€„á€ºá€¸ */
        #toast-message {
            position: fixed;
            top: 20px; /* á€™á€»á€€á€ºá€”á€¾á€¬á€•á€¼á€„á€ºá á€¡á€•á€±á€«á€ºá€˜á€€á€ºá€á€½á€„á€º á€”á€±á€›á€¬á€šá€°á€…á€±á€›á€”á€º */
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--success);
            color: white;
            padding: 12px 25px; /* á€•á€­á€¯á€€á€¼á€®á€¸á€á€±á€¬ á€”á€±á€›á€¬á€šá€°á€™á€¾á€¯ */
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.35); /* Shadow á€€á€­á€¯ á€•á€­á€¯á€™á€­á€¯ á€‘á€„á€ºá€›á€¾á€¬á€¸á€…á€±á€›á€”á€º */
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s, visibility 0s linear 0.5s;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
        }
        #toast-message.show {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.5s, visibility 0s linear 0s;
        }

        /* ==================== Number Pad Styles (Calculator Cart) ==================== */
        /* ğŸ’¡ Cash Input á€¡á€±á€¬á€€á€ºá€”á€¬á€¸á€á€½á€„á€º á€•á€¼á€…á€±á€›á€”á€º */
        .number-pad-modal {
            /* position: absolute; */ /* Change to relative positioning to flow naturally, or keep absolute but adjust bottom */
            position: absolute; 
            /* bottom: 100px; */ /* To place it below the cash and quick buttons */
            bottom: 300px; /* Adjusted to sit nicely above the action buttons */
            right: 15px;
            z-index: 1100;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: var(--shadow-md);
            padding: 10px;
            width: 250px;
            display: none;
            flex-direction: column;
            gap: 10px;
            transition: all 0.2s ease-in-out;
        }
        .number-pad-modal.active {
            display: flex;
        }
        .pad-display {
            background-color: var(--input-bg);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 10px;
            font-size: 20px;
            font-weight: bold;
            text-align: right;
            color: var(--text);
            min-height: 40px;
        }
        .pad-buttons-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
        }
        .pad-btn {
            padding: 15px 5px;
            border: none;
            border-radius: 5px;
            background-color: var(--accent);
            color: var(--text);
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.1s;
        }
        .pad-btn:hover {
            background-color: var(--primary);
            color: white;
        }
        .pad-btn.action {
            background-color: var(--info);
            color: white;
        }
        .pad-btn.action.clear {
            background-color: var(--danger);
        }

        /* ğŸ’¡ Cash Input á€á€½á€„á€º Readonly á€¡á€–á€¼á€…á€º á€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€œá€­á€¯á€€á€ºá€á€¼á€„á€ºá€¸ (Cursor/Typing á€€á€­á€¯ á€€á€¬á€€á€½á€šá€ºá€›á€”á€º) */
        .input-group-field input[readonly] {
            cursor: pointer; /* Click to open number pad */
            background-color: var(--input-bg); /* Ensure it looks like an input */
        }
        
    </style>
</head>
<body class="light-theme">
<div class="container">
    <div class="nav-tabs">
        <div class="nav-tab active" data-tab="pos-section">ğŸ’° POS á€…á€”á€…á€º</div>
        <div class="nav-tab" data-tab="management-section">ğŸ“¦ á€•á€…á€¹á€…á€Šá€ºá€¸á€…á€®á€™á€¶á€á€”á€·á€ºá€á€½á€²á€™á€¾á€¯</div>
        <div class="nav-tab" data-tab="dashboard-section">ğŸ“ˆ Dashboard</div>
        <div class="nav-tab" data-tab="reports-section">ğŸ§¾ á€¡á€›á€±á€¬á€„á€ºá€¸á€™á€¾á€á€ºá€á€™á€ºá€¸/Reports</div>
        <div class="nav-tab" data-tab="settings-section">âš™ï¸ Settings</div>

        <div class="cart-nav-icon" title="á€…á€»á€±á€¸á€á€¼á€„á€ºá€¸">
            <i class="fas fa-shopping-cart"></i>
            <span class="cart-count" id="navCartCount">0</span>
        </div>
    </div>

    <div class="content-area">

        <div class="tab-content active" id="pos-section">
            <div class="pos-layout">
                <div class="pos-product-list">
                    <h3>á€•á€…á€¹á€…á€Šá€ºá€¸á€™á€»á€¬á€¸ (Products)</h3>

                    <div class="controls-group">
                        <select id="posCategoryFilter" onchange="renderPOSProducts()">
                        </select>
                        <input type="text" id="posProductSearch" oninput="renderPOSProducts()" placeholder="á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€™á€Šá€ºá€›á€¾á€¬á€›á€”á€º..." style="flex-grow: 1;">
                    </div>

                    <div class="product-grid" id="posProductGrid">
                    </div>
                </div>

                <div class="pos-cart-section">
                    <div class="cart-header">á€…á€»á€±á€¸á€á€¼á€„á€ºá€¸á€œá€¾á€Šá€ºá€¸ (Sales Cart)</div>

                    <div class="cart-items" id="cartItems">
                        <div class="empty-cart" style="text-align: center; color: var(--text-light); padding: 15px 0;">á€…á€»á€±á€¸á€á€šá€ºá€á€¼á€„á€ºá€¸á€™á€›á€¾á€­á€á€±á€¸á€•á€«</div>
                    </div>

                    <div class="input-group-controls" style="border-top: none; margin-bottom: 0;">
                        <div class="discount-input">
                            <label for="discount_percent" class="input-group-label" style="font-size: 18px; margin-top: 5px;">Discount (%):</label>
                            <div class="input-group-field">
                                <input
                                        type="number"
                                        id="discount_percent"
                                        min="0"
                                        max="100"
                                        placeholder="0"
                                        style="padding: 10px;"
                                        onfocus="openNumberPad(true, 'discount_percent')"
                                        readonly="readonly"
                                        onchange="calculateTotals()"
                                >
                                <span>%</span>
                            </div>
                        </div>
                    </div>

                    <div class="cart-summary">
                        <div class="summary-row">
                            <span>Subtotal:</span>
                            <span id="subtotal">0</span>
                        </div>
                        <div class="summary-row">
                            <span>Discount:</span>
                            <span id="discount-display">0</span>
                        </div>
                        <div class="summary-row total-row">
                            <span>Total:</span>
                            <span id="total">0</span>
                        </div>
                        <div class="cash-row summary-row">
                            <span>Cash:</span>
                            <span id="cash-display">0</span>
                        </div>
                        <div class="change-row summary-row">
                            <span>Change:</span>
                            <span id="change">0</span>
                        </div>
                    </div>

                    <div class="input-group-controls" style="margin-top: 15px; border-top: 1px solid var(--border);">
                        <div class="cash-input" style="flex: 1;">
                            <label for="cash" class="input-group-label" style="font-size: 18px; margin-top: 5px;">á€•á€±á€¸á€„á€½á€± (Cash MMK):</label>
                            <div class="input-group-field">
                                <input
                                        type="number"
                                        id="cash"
                                        min="0"
                                        placeholder="0"
                                        style="padding: 10px;"
                                        onfocus="openNumberPad(true, 'cash')"
                                        readonly="readonly"
                                        onchange="calculateTotals()"
                                >
                                <span>MMK</span>
                            </div>
                        </div>
                    </div>

                    <div class="quick-cash-buttons">
                        <button class="btn btn-quick-cash" onclick="setCashAmount(5000)">5,000</button>
                        <button class="btn btn-quick-cash" onclick="setCashAmount(10000)">10,000</button>
                        <button class="btn btn-quick-cash" onclick="setCashAmount(20000)">20,000</button>
                        <button class="btn btn-quick-cash" onclick="setCashAmount('auto')">Auto Round</button>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-clear" onclick="clearCart()">
                            <span>âœ–ï¸ á€›á€¾á€„á€ºá€¸á€™á€Šá€º</span>
                        </button>
                        <button class="btn btn-save" onclick="saveOrder(false)">
                            <span>ğŸ’¾ á€á€­á€™á€ºá€¸á€™á€Šá€º</span>
                        </button>
                        <button class="btn btn-print" onclick="printReceipt()">
                            <span>ğŸ–¨ï¸ á€˜á€±á€¬á€„á€ºá€á€»á€¬á€‘á€¯á€á€º</span>
                        </button>
                    </div>

                    <div class="number-pad-modal" id="numberPadModal">
                        <div class="pad-display" id="padDisplay">0</div>
                        <div class="pad-buttons-grid">
                            <button class="pad-btn" onclick="handleNumberPadInput('7')">7</button>
                            <button class="pad-btn" onclick="handleNumberPadInput('8')">8</button>
                            <button class="pad-btn" onclick="handleNumberPadInput('9')">9</button>
                            <button class="pad-btn action clear" onclick="handleNumberPadInput('clear')">C</button>

                            <button class="pad-btn" onclick="handleNumberPadInput('4')">4</button>
                            <button class="pad-btn" onclick="handleNumberPadInput('5')">5</button>
                            <button class="pad-btn" onclick="handleNumberPadInput('6')">6</button>
                            <button class="pad-btn action" onclick="handleNumberPadInput('back')"><i class="fas fa-backspace"></i></button>

                            <button class="pad-btn" onclick="handleNumberPadInput('1')">1</button>
                            <button class="pad-btn" onclick="handleNumberPadInput('2')">2</button>
                            <button class="pad-btn" onclick="handleNumberPadInput('3')">3</button>
                            <button class="pad-btn action" onclick="handleNumberPadInput('apply')">OK</button>

                            <button class="pad-btn" onclick="handleNumberPadInput('0')">0</button>
                            <button class="pad-btn" onclick="handleNumberPadInput('00')">00</button>
                            <button class="pad-btn" onclick="handleNumberPadInput('.')">.</button>
                            <button class="pad-btn action" onclick="openNumberPad(false)">âœ–ï¸</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="management-section">
            <div class="management-header controls-group" style="justify-content: space-between;">
                <h2>ğŸ“¦ á€•á€…á€¹á€…á€Šá€ºá€¸á€…á€¬á€›á€„á€ºá€¸á€…á€®á€™á€¶á€á€”á€·á€ºá€á€½á€²á€™á€¾á€¯</h2>
                <button class="btn btn-add-new" onclick="openProductModal()">
                    <span>+ á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€á€…á€ºá€‘á€Šá€·á€ºá€™á€Šá€º</span>
                </button>
            </div>

            <div class="controls-group">
                <input type="text" class="search-box" placeholder="á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€™á€Šá€ºá€›á€¾á€¬á€›á€”á€º..." id="managementSearchBox">
                <select class="filter-select" id="managementCategoryFilter" onchange="renderProductsTable()">
                </select>
            </div>

            <div style="flex-grow: 1; overflow-y: auto;">
                <table class="reports-table product-management-table">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>á€“á€¬á€á€ºá€•á€¯á€¶</th>
                        <th>á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€™á€Šá€º</th>
                        <th>á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸</th>
                        <th>á€¡á€™á€»á€­á€¯á€¸á€¡á€…á€¬á€¸</th>
                        <th>á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€á€»á€€á€º</th>
                    </tr>
                    </thead>
                    <tbody id="productsTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <div class="tab-content" id="dashboard-section">
            <h2>ğŸ“ˆ Dashboard Overview</h2>

            <div class="controls-group" style="border: 1px solid var(--border); padding: 10px; border-radius: 6px;">
                <label>Start Date:</label>
                <input type="date" id="dashboardRangeStartDate">
                <label>End Date:</label>
                <input type="date" id="dashboardRangeEndDate">
                <button class="btn btn-info" onclick="renderDashboard()">
                    <span>ğŸ” á€›á€€á€ºá€…á€½á€²á€–á€¼á€„á€·á€º á€€á€¼á€Šá€·á€ºá€™á€Šá€º</span>
                </button>
            </div>

            <div class="summary-cards">
                <div class="card" style="border-left-color: var(--success);">
                    <div class="card-title">ğŸ“… **á€á€…á€ºá€”á€±á€· á€¡á€›á€±á€¬á€„á€ºá€¸ (Today's Sales)**</div>
                    <div class="card-value" id="todayTotalSales">0</div> </div>
                <div class="card" style="border-left-color: var(--info);">
                    <div class="card-title">ğŸ’µ á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸ á€¡á€›á€±á€¬á€„á€ºá€¸ (Range)</div>
                    <div class="card-value" id="dailyTotalSales">0</div>
                </div>
                <div class="card" style="border-left-color: var(--danger);">
                    <div class="card-title">ğŸ á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸ Discount (Range)</div>
                    <div class="card-value" id="dailyTotalDiscount">0</div>
                </div>
                <div class="card" style="border-left-color: var(--accent);">
                    <div class="card-title">ğŸ“¦ á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸ Qty (Range)</div>
                    <div class="card-value" id="dailyTotalQuantity">0 á€á€¯</div>
                </div>
                <div class="card" style="border-left-color: var(--danger);">
                    <div class="card-title">ğŸ§¾ á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸ á€˜á€±á€¬á€„á€ºá€á€»á€¬ (Range)</div>
                    <div class="card-value" id="dailyTotalReceipts">0 á€á€¯</div>
                </div>
            </div>

            <h3>á€•á€…á€¹á€…á€Šá€ºá€¸á€›á€±á€¬á€„á€ºá€¸á€¡á€¬á€¸ á€¡á€€á€»á€‰á€ºá€¸á€á€»á€¯á€•á€º (Product Sales Summary)</h3>
            <div class="controls-group">
                <input type="text" id="dashboardProductNameSearch" oninput="renderDashboardProductSummary()" placeholder="á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€™á€Šá€ºá€›á€¾á€¬á€›á€”á€º" style="flex-grow: 1;">
                <button class="btn btn-print" onclick="exportDashboardSummaryToExcel()">
                    <span>ğŸ“Š Excel Download</span>
                </button>
            </div>

            <div style="overflow-x: auto;">
                <table class="reports-table">
                    <thead>
                    <tr>
                        <th>á€›á€€á€ºá€…á€½á€² (á€•á€‘á€™á€›á€±á€¬á€„á€ºá€¸á€›á€€á€º)</th>
                        <th>á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€™á€Šá€º</th>
                        <th>á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸/á€á€á€¯</th>
                        <th>Qty á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸</th>
                        <th>Total á€á€„á€ºá€„á€½á€±</th>
                    </tr>
                    </thead>
                    <tbody id="dashboardProductSummaryTable">
                    </tbody>
                </table>
            </div>
        </div>

        <div class="tab-content" id="reports-section">
            <h2>ğŸ§¾ á€¡á€›á€±á€¬á€„á€ºá€¸á€™á€¾á€á€ºá€á€™á€ºá€¸ (Reports)</h2>

            <div class="controls-group" style="border: 1px solid var(--border); padding: 10px; border-radius: 6px;">
                <label>Start Date:</label>
                <input type="date" id="reportStartDate">
                <label>End Date:</label>
                <input type="date" id="reportEndDate">
                <button class="btn btn-add-new" onclick="renderReportsTable()">
                    <span>ğŸ” á€›á€€á€ºá€…á€½á€²á€–á€¼á€„á€·á€º á€€á€¼á€Šá€·á€ºá€™á€Šá€º</span>
                </button>
                <button class="btn btn-print" onclick="exportReportsToExcel()">
                    <span>ğŸ“Š Excel Download</span>
                </button>
            </div>

            <div class="controls-group" style="margin-top: 10px;">
                <input type="text" id="reportProductNameSearch" placeholder="á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€™á€Šá€º á€á€­á€¯á€· á€˜á€±á€¬á€„á€ºá€á€»á€¬ ID á€›á€¾á€¬á€›á€”á€º" oninput="renderReportsTable()" style="flex-grow: 1;">
                <button class="btn btn-danger" onclick="deleteSalesByDate()">
                    <span>ğŸ—‘ï¸ á€™á€¾á€á€ºá€á€™á€ºá€¸á€–á€»á€€á€ºá€™á€Šá€º</span>
                </button>
            </div>

            <div style="overflow-x: auto;">
                <table class="reports-table">
                    <thead>
                    <tr>
                        <th>á€›á€€á€ºá€…á€½á€²/á€¡á€á€»á€­á€”á€º</th>
                        <th>á€˜á€±á€¬á€„á€ºá€á€»á€¬ ID</th>
                        <th>á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€™á€Šá€º</th>
                        <th>á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸/á€á€á€¯</th>
                        <th>Qty</th>
                        <th>Total (Item)</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="reportsTableBody">
                    </tbody>
                </table>
            </div>

            <div class="reports-summary">
                <div>**Qty á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸:** <span id="reportTotalQty">0</span> á€á€¯</div>
                <div>**Total á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸:** <span id="reportTotalSales">0</span></div>
            </div>
        </div>

        <div class="tab-content" id="settings-section">
            <h2>âš™ï¸ Settings - á€†á€­á€¯á€„á€ºá€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€”á€¾á€„á€ºá€· á€…á€”á€…á€ºá€…á€®á€™á€¶á€á€”á€·á€ºá€á€½á€²á€™á€¾á€¯</h2>

            <div class="settings-form">

                <h3>Theme á€›á€½á€±á€¸á€á€»á€šá€ºá€™á€¾á€¯</h3>
                <div class="form-group">
                    <label for="themeSelect" class="form-label">á€…á€”á€…á€ºá á€¡á€á€½á€„á€ºá€¡á€•á€¼á€„á€º (Theme):</label>
                    <select id="themeSelect" class="form-select" onchange="switchTheme(this.value)">
                        <option value="light">Light Theme (á€¡á€œá€„á€ºá€¸)</option>
                        <option value="dark">Dark Theme (á€¡á€™á€¾á€±á€¬á€„á€º)</option>
                    </select>
                </div>

                <h3>á€˜á€±á€¬á€„á€ºá€á€»á€¬ á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€™á€»á€¬á€¸</h3>
                <div class="form-group">
                    <label for="shopName" class="form-label">á€†á€­á€¯á€„á€ºá€¡á€™á€Šá€º:</label>
                    <input type="text" id="shopName" class="form-input" placeholder="á€¥á€•á€™á€¬: My Coffee Shop">
                </div>
                <div class="form-group">
                    <label for="shopAddress" class="form-label">á€†á€­á€¯á€„á€ºá€œá€­á€•á€ºá€…á€¬:</label>
                    <input type="text" id="shopAddress" class="form-input" placeholder="á€¥á€•á€™á€¬: á€œá€™á€ºá€¸á€™á€á€±á€¬á€ºá€œá€™á€ºá€¸áŠ á€›á€”á€ºá€€á€¯á€”á€º">
                </div>
                <div class="form-group">
                    <label for="shopPhone" class="form-label">á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€º:</label>
                    <input type="text" id="shopPhone" class="form-input" placeholder="á€¥á€•á€™á€¬: 09-123456789">
                </div>
                <div class="form-group">
                    <label for="receiptThankYou" class="form-label">á€€á€»á€±á€¸á€‡á€°á€¸á€á€„á€ºá€…á€€á€¬á€¸ (á€˜á€±á€¬á€„á€ºá€á€»á€¬á€¡á€±á€¬á€€á€ºá€†á€¯á€¶á€¸):</label>
                    <textarea id="receiptThankYou" rows="2" class="form-textarea" placeholder="á€¥á€•á€™á€¬: á€€á€»á€±á€¸á€‡á€°á€¸á€á€„á€ºá€•á€«á€á€šá€ºáŠ á€”á€±á€¬á€€á€ºá€™á€¾á€•á€¼á€”á€ºá€œá€¬á€á€²á€·á€•á€«á€¦á€¸á‹"></textarea>
                </div>
                <div class="form-group">
                    <label for="receiptSize" class="form-label">á€˜á€±á€¬á€„á€ºá€á€»á€¬ á€…á€¬á€›á€½á€€á€º á€¡á€›á€½á€šá€ºá€¡á€…á€¬á€¸:</label>
                    <select id="receiptSize" class="form-select">
                        <option value="80mm">80mm (á€•á€›á€„á€·á€ºá€á€¬á€¡á€€á€¼á€®á€¸)</option>
                        <option value="58mm">58mm (á€•á€›á€„á€·á€ºá€á€¬á€¡á€á€±á€¸)</option>
                    </select>
                </div>

                <button class="btn btn-save" onclick="saveSettings()" style="margin-top: 15px;">
                    <span>ğŸ’¾ á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€™á€»á€¬á€¸ á€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€™á€Šá€º</span>
                </button>

                <h3 style="color: var(--danger);">Invoice Number á€…á€®á€™á€¶á€á€”á€·á€ºá€á€½á€²á€™á€¾á€¯</h3>
                <p>á€œá€€á€ºá€›á€¾á€­ Invoice Number: <strong id="currentInvNumber">000001</strong></p>
                <div class="form-group">
                    <button class="btn btn-danger" onclick="resetInvoiceNumber()">
                        <span>ğŸ”„ Invoice Number 000001 á€™á€¾ á€•á€¼á€”á€ºá€…á€™á€Šá€º (Reset)</span>
                    </button>
                </div>
            </div>
        </div>

    </div>
</div>

<div id="productModal" class="modal">
    <div class="modal-content">
        <div class="modal-title" id="productModalTitle">á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€á€…á€ºá€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€á€¼á€„á€ºá€¸</div>

        <div class="form-group">
            <label for="productName" class="form-label">á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€™á€Šá€º:</label>
            <input type="text" id="productName" class="form-input" placeholder="á€™á€¯á€”á€·á€ºáŠ á€á€±á€¬á€€á€ºá€…á€›á€¬ á€¡á€™á€Šá€º">
        </div>

        <div class="form-group">
            <label for="productPrice" class="form-label">á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸ (MMK):</label>
            <input type="number" id="productPrice" class="form-input" placeholder="á€¥á€•á€™á€¬: 1500" min="0">
        </div>

        <div class="form-group">
            <label for="productCategory" class="form-label">á€¡á€™á€»á€­á€¯á€¸á€¡á€…á€¬á€¸:</label>
            <select id="productCategory" class="form-select">
            </select>
        </div>

        <div class="form-group">
            <label class="form-label">á€“á€¬á€á€ºá€•á€¯á€¶á€‘á€Šá€·á€ºá€›á€”á€º:</label>
            <div class="image-upload-area" onclick="document.getElementById('productImageFile').click()">
                <input type="file" id="productImageFile" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                <p style="margin: 0;">á€•á€¯á€¶á€‘á€Šá€·á€ºá€›á€”á€º á€¤á€”á€±á€›á€¬á€€á€­á€¯ á€”á€¾á€­á€•á€ºá€•á€« (á€á€­á€¯á€·) á€•á€¯á€¶á€€á€­á€¯ á€†á€½á€²á€‘á€Šá€·á€ºá€•á€«</p>
            </div>
            <div id="imagePreviewContainer" class="image-preview-container" style="display:none;">
                <img id="imagePreview" class="image-preview" alt="Preview" onerror="this.src='DEFAULT_IMAGE'">
                <button class="delete-image-btn" onclick="deleteImage(event)">âœ–ï¸</button>
            </div>
        </div>

        <div id="productError" class="error-message" style="display:none; color: var(--danger); font-weight: bold;"></div>

        <div class="modal-actions">
            <button class="btn btn-save" onclick="saveProduct()" style="flex: 2;">
                <span>ğŸ’¾ á€á€­á€™á€ºá€¸á€™á€Šá€º</span>
            </button>
            <button class="btn btn-clear" onclick="closeProductModal(true)" style="flex: 1;">
                <span>âœ–ï¸ á€•á€šá€ºá€–á€»á€€á€ºá€™á€Šá€º</span>
            </button>
        </div>
    </div>
</div>

<div id="printArea" style="display:none;"></div>

<div id="toast-message">
    <i class="fas fa-check-circle" style="font-size: 20px;"></i>
    <span id="toast-text">á€•á€…á€¹á€…á€Šá€ºá€¸á€€á€­á€¯ á€á€½á€”á€ºá€¸á€œá€¾á€Šá€ºá€¸á€‘á€² á€‘á€Šá€·á€ºá€œá€­á€¯á€€á€ºá€•á€«á€•á€¼á€®á‹</span>
</div>
<script>
    // ==================== Global Variables ====================
    const categories = [
        { id: 1, name: 'á€¡á€¬á€¸á€œá€¯á€¶á€¸' },
        { id: 2, name: 'á€¡á€“á€­á€€á€¡á€…á€¬á€¸á€¡á€…á€¬' },
        { id: 3, name: 'á€¡á€¡á€±á€¸/á€á€±á€¬á€€á€ºá€…á€›á€¬' },
        { id: 4, name: 'á€¡á€á€»á€­á€¯á€•á€½á€²/Snacks' },
        { id: 5, name: 'á€¡á€á€¼á€¬á€¸' },
        { id: 6, name: 'á€œá€»á€¾á€±á€¬á€·á€ˆá€±á€¸ Card' }
    ];

    let products = [];
    let cart = [];
    let salesHistory = [];
    let currentEditingProductId = null;
    let invoiceNumber = 1;
    let currentModalImageBase64 = '';
    const LOW_STOCK_THRESHOLD = 5; // âŒ Stock logic is removed, but keeping const for reference.

    let settings = {
        shopName: 'My POS Shop',
        shopAddress: 'No. 123, Downtown',
        shopPhone: '09-123456789',
        receiptThankYou: 'á€€á€»á€±á€¸á€‡á€°á€¸á€á€„á€ºá€•á€«á€á€šá€ºáŠ á€”á€±á€¬á€€á€ºá€™á€¾á€•á€¼á€”á€ºá€œá€¬á€á€²á€·á€•á€«á€¦á€¸á‹',
        receiptSize: '80mm',
        theme: 'light'
    };

    // Default image for error handling
    const DEFAULT_IMAGE = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="90" height="90" viewBox="0 0 90 90"><rect width="90" height="90" fill="%23EFEFEF"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="Arial" font-size="14" fill="%23999999">No Image</text></svg>';
    const NO_IMAGE_PLACEHOLDER = '';

    // GEMINI ADDITION for Number Pad
    let currentNumberPadValue = '0';
    let isNewNumber = true; // Flag to check if the next digit should replace '0' or append
    let targetInputId = ''; // To track which input field is active ('cash' or 'discount_percent')
    // END GEMINI ADDITION


    // ==================== Helper/Utility Functions ====================
    function formatCurrency(amount, withUnit = true) {
        const formatted = Math.round(amount).toLocaleString();
        return withUnit ? `${formatted} á€€á€»á€•á€º` : formatted;
    }

    function formatInvoiceNumber(num) {
        return String(num).padStart(6, '0');
    }

    function getCategoryName(id) {
        const cat = categories.find(c => c.id === id);
        return cat ? cat.name : 'N/A';
    }

    function getFormattedDateTime(date) {
        const d = new Date(date);
        const dateStr = d.toLocaleDateString('en-CA', { year: 'numeric', month: '2-digit', day: '2-digit' });
        const timeStr = d.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
        return `${dateStr.replace(/\//g, '-')} ${timeStr}`;
    }

    function getDateOnly(dateString) {
        if (!dateString) return null;
        const [year, month, day] = dateString.split('-').map(Number);
        return new Date(Date.UTC(year, month - 1, day));
    }

    function getTodayDateString() {
        const today = new Date();
        const year = today.getUTCFullYear();
        const month = String(today.getUTCMonth() + 1).padStart(2, '0');
        const day = String(today.getUTCDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }


    // ==================== Image Upload Handling ====================
    function handleImageUpload(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                currentModalImageBase64 = e.target.result;
                showImagePreview(currentModalImageBase64);
            };
            reader.readAsDataURL(file);
        }
    }

    function showImagePreview(base64Image) {
        const previewContainer = document.getElementById('imagePreviewContainer');
        const previewImage = document.getElementById('imagePreview');
        const uploadArea = document.querySelector('.image-upload-area');

        const hasImage = base64Image && base64Image !== NO_IMAGE_PLACEHOLDER;

        if (hasImage) {
            previewImage.src = base64Image;
            previewContainer.style.display = 'flex';
            uploadArea.style.display = 'none';
        } else {
            previewImage.src = '';
            previewContainer.style.display = 'none';
            uploadArea.style.display = 'block';
        }
    }

    function deleteImage(event) {
        event.stopPropagation();
        currentModalImageBase64 = NO_IMAGE_PLACEHOLDER;
        document.getElementById('productImageFile').value = '';
        showImagePreview(NO_IMAGE_PLACEHOLDER);
    }

    // ==================== Data Loading/Saving ====================
    function loadData() {
        const savedProducts = localStorage.getItem('posProducts');
        if (savedProducts) products = JSON.parse(savedProducts);
        else {
            // Initial Dummy Data to display on POS/Management screens
            products = [
                // âŒ stock á€€á€­á€¯á€–á€šá€ºá€œá€­á€¯á€€á€ºá€•á€«á€•á€¼á€®
                { id: 1, name: 'Chicken Burger', price: 3500, category: 2, categoryName: 'á€¡á€“á€­á€€á€¡á€…á€¬á€¸á€¡á€…á€¬', image: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="90" height="90" viewBox="0 0 90 90"><rect width="90" height="90" fill="%23FFE0B2"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="Arial" font-size="14" fill="%23000">CB</text></svg>' },
                { id: 2, name: 'Original Burger', price: 3000, category: 2, categoryName: 'á€¡á€“á€­á€€á€¡á€…á€¬á€¸á€¡á€…á€¬', image: NO_IMAGE_PLACEHOLDER },
                { id: 3, name: 'Cola', price: 1000, category: 3, categoryName: 'á€¡á€¡á€±á€¸/á€á€±á€¬á€€á€ºá€…á€›á€¬', image: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="90" height="90" viewBox="0 0 90 90"><rect width="90" height="90" fill="%238D6E63"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="Arial" font-size="14" fill="%23FFF">CL</text></svg>' },
                { id: 4, name: 'Fried Chicken', price: 1500, category: 2, categoryName: 'á€¡á€“á€­á€€á€¡á€…á€¬á€¸á€¡á€…á€¬', image: NO_IMAGE_PLACEHOLDER },
                { id: 5, name: 'VIP Discount Card', price: 5000, category: 6, categoryName: 'á€œá€»á€¾á€±á€¬á€·á€ˆá€±á€¸ Card', image: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="90" height="90" viewBox="0 0 90 90"><rect width="90" height="90" fill="%23FFD700"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="Arial" font-size="14" fill="%23000">Card</text></svg>' },
            ];
        }
        products = products.map(p => ({
            ...p,
            // âŒ stock á€€á€­á€¯ default á€‘á€¬á€¸á€á€²á€·á€á€¼á€„á€ºá€¸ (á€á€­á€¯á€·) á€›á€¾á€­á€•á€¼á€®á€¸á€á€¬á€¸ data á€€á€­á€¯ 0 á€á€á€ºá€™á€¾á€á€ºá€á€¼á€„á€ºá€¸ (optional - á€›á€¾á€„á€ºá€¸á€…á€±á€›á€”á€º)
            stock: 999999, // Stock logic removed, setting a large default value for any legacy code.
            image: p.image || NO_IMAGE_PLACEHOLDER
        }));


        const savedSales = localStorage.getItem('posSalesHistory');
        if (savedSales) salesHistory = JSON.parse(savedSales);

        const savedInvoiceNum = localStorage.getItem('posInvoiceNumber');
        if (savedInvoiceNum) invoiceNumber = parseInt(savedInvoiceNum);

        const savedSettings = localStorage.getItem('posSettings');
        if (savedSettings) {
            Object.assign(settings, JSON.parse(savedSettings));
        }
    }

    function saveData() {
        localStorage.setItem('posProducts', JSON.stringify(products));
        localStorage.setItem('posSalesHistory', JSON.stringify(salesHistory));
        localStorage.setItem('posInvoiceNumber', invoiceNumber);
        localStorage.setItem('posSettings', JSON.stringify(settings));
    }

    // ==================== Initialization & Navigation ====================
    function init() {
        loadData();
        document.body.classList.remove('light-theme', 'dark-theme');
        document.body.classList.add(`${settings.theme}-theme`);

        setupNavigation();

        populateCategoryFilters('managementCategoryFilter');
        populateCategoryFilters('posCategoryFilter');
        populateCategorySelect();

        renderProductsTable();
        renderPOSProducts();
        renderCart();
        renderDashboard();
        renderReportsTable();
        loadSettings();

        // NOTE: Discount and Cash inputs now use onchange/onfocus for Number Pad control.
        document.getElementById('managementSearchBox').addEventListener('input', renderProductsTable);
        document.getElementById('reportProductNameSearch').addEventListener('input', renderReportsTable);

        document.getElementById('currentInvNumber').textContent = formatInvoiceNumber(invoiceNumber);

        // GEMINI ADDITION: Initial Cart Count Update
        updateNavCartCount();
        // END GEMINI ADDITION
    }

    function setupNavigation() {
        const tabs = document.querySelectorAll('.nav-tab');
        const contents = document.querySelectorAll('.tab-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                contents.forEach(c => c.classList.remove('active'));

                tab.classList.add('active');
                const targetId = tab.getAttribute('data-tab');
                document.getElementById(targetId).classList.add('active');

                // Close Number Pad when switching tabs
                openNumberPad(false);

                if (targetId === 'management-section') renderProductsTable();
                if (targetId === 'pos-section') renderPOSProducts();
                if (targetId === 'dashboard-section') renderDashboard();
                if (targetId === 'reports-section') renderReportsTable();
                if (targetId === 'settings-section') loadSettings();
            });
        });
    }

    function populateCategoryFilters(selectId) {
        const select = document.getElementById(selectId);
        select.innerHTML = '';
        categories.forEach(category => {
            const option = document.createElement('option');
            option.value = category.id;
            option.textContent = category.name;
            select.appendChild(option);
        });
    }

    // ==================== Product Management Table (Management Tab) ====================
    function renderProductsTable() {
        const tableBody = document.getElementById('productsTableBody');
        tableBody.innerHTML = '';

        const searchTerm = document.getElementById('managementSearchBox').value.toLowerCase();
        const filterCategoryId = parseInt(document.getElementById('managementCategoryFilter').value);

        let filteredProducts = products.filter(p => {
            const matchesSearch = p.name.toLowerCase().includes(searchTerm);
            const matchesFilter = filterCategoryId === 1 || p.category === filterCategoryId;
            return matchesSearch && matchesFilter;
        }).sort((a, b) => a.name.localeCompare(b.name, 'my')); // âŒ Stock sorting logic removed

        if (filteredProducts.length === 0) {
            tableBody.innerHTML = `
      <tr>
        <td colspan="6" style="text-align:center; padding:20px; color:var(--text-light);">
          á€•á€…á€¹á€…á€Šá€ºá€¸á€…á€¬á€›á€„á€ºá€¸á€™á€á€½á€±á€·á€•á€«
        </td>
      </tr>
    `;
            return;
        }

        filteredProducts.forEach((product) => {
            // âŒ Stock Display logic removed.
            
            const imageSrc = product.image && product.image !== NO_IMAGE_PLACEHOLDER ? product.image : NO_IMAGE_PLACEHOLDER;
            const imageDisplay = imageSrc ?
                `<img src="${imageSrc}" alt="${product.name}" style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px;" onerror="this.classList.add('hidden')">` :
                `<span style="color:var(--text-light); font-size: 10px;">(á€•á€¯á€¶á€™á€›á€¾á€­)</span>`;


            const tr = document.createElement('tr');
            tr.innerHTML = `
      <td>${product.id}</td>
      <td style="text-align: center;">${imageDisplay}</td>
      <td>${product.name}</td>
      <td>${formatCurrency(product.price, true)}</td>
      <td>${product.categoryName}</td>
      <td class="action-cell">
        <button class="action-icon edit-icon" onclick="openProductModal(products.find(p => p.id === ${product.id}))" title="á€•á€¼á€„á€ºá€™á€Šá€º">
            &#9998;
        </button>
        <button class="action-icon delete-icon" onclick="deleteProduct(${product.id})" title="á€–á€»á€€á€ºá€™á€Šá€º">
            &#128465;
        </button>
      </td>
    `;
            tableBody.appendChild(tr);
        });
    }

    // ==================== Product Modal (Form Logic) ====================
    function populateCategorySelect() {
        const select = document.getElementById('productCategory');
        select.innerHTML = '';
        categories.slice(1).forEach(category => {
            const option = document.createElement('option');
            option.value = category.id;
            option.textContent = category.name;
            select.appendChild(option);
        });
        if (select.options.length > 0) select.value = categories[1].id;
    }

    function openProductModal(product = null) {
        openNumberPad(false); // Close Number Pad when opening another modal

        const modal = document.getElementById('productModal');
        const errorDiv = document.getElementById('productError');
        const modalTitle = document.getElementById('productModalTitle');
        errorDiv.style.display = 'none';
        errorDiv.textContent = '';

        document.getElementById('productName').value = '';
        document.getElementById('productPrice').value = '';
        // âŒ document.getElementById('productStock').value = 1; // Stock removed
        document.getElementById('productCategory').value = categories[1].id;
        document.getElementById('productImageFile').value = '';
        currentEditingProductId = null;
        currentModalImageBase64 = NO_IMAGE_PLACEHOLDER;
        showImagePreview(NO_IMAGE_PLACEHOLDER);

        if (product) {
            document.getElementById('productName').value = product.name;
            document.getElementById('productPrice').value = product.price;
            // âŒ document.getElementById('productStock').value = product.stock; // Stock removed

            currentModalImageBase64 = product.image || NO_IMAGE_PLACEHOLDER;
            showImagePreview(currentModalImageBase64);

            currentEditingProductId = product.id;
            modalTitle.textContent = 'á€•á€…á€¹á€…á€Šá€ºá€¸á€•á€¼á€„á€ºá€†á€„á€ºá€á€¼á€„á€ºá€¸';
        } else {
            modalTitle.textContent = 'á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€á€…á€ºá€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€á€¼á€„á€ºá€¸';
        }

        modal.style.display = 'block';
        setTimeout(() => modal.classList.add('active'), 10);
    }

    function closeProductModal(clearForm = false) {
        const modal = document.getElementById('productModal');
        modal.classList.remove('active');
        setTimeout(() => {
            modal.style.display = 'none';
            if (clearForm) {
                document.getElementById('productName').value = '';
                document.getElementById('productPrice').value = '';
                // âŒ document.getElementById('productStock').value = 1; // Stock removed
                document.getElementById('productCategory').value = categories[1].id;
                document.getElementById('productError').style.display = 'none';
                document.getElementById('productImageFile').value = '';
                currentModalImageBase64 = NO_IMAGE_PLACEHOLDER;
                currentEditingProductId = null;
                showImagePreview(NO_IMAGE_PLACEHOLDER);
            }
        }, 300);
    }

    function deleteProduct(id) {
        if (confirm('á€’á€®á€•á€…á€¹á€…á€Šá€ºá€¸á€€á€­á€¯ á€…á€¬á€›á€„á€ºá€¸á€‘á€²á€€á€”á€± á€–á€»á€€á€ºá€™á€¾á€¬á€á€±á€á€»á€¬á€•á€«á€á€œá€¬á€¸?')) {
            products = products.filter(p => p.id !== id);
            saveData();
            renderProductsTable();
            renderPOSProducts();
            alert('á€•á€…á€¹á€…á€Šá€ºá€¸á€–á€»á€€á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®');
        }
    }

    function saveProduct() {
        const name = document.getElementById('productName').value.trim();
        const price = parseFloat(document.getElementById('productPrice').value);
        // âŒ Stock Removed
        // const stock = parseInt(document.getElementById('productStock').value);
        const categoryId = parseInt(document.getElementById('productCategory').value);
        const errorDiv = document.getElementById('productError');
        errorDiv.style.display = 'none';

        if (!name || isNaN(price) || price <= 0) {
            errorDiv.textContent = 'á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€™á€Šá€ºá€”á€¾á€„á€·á€º á€™á€¾á€”á€ºá€€á€”á€ºá€á€±á€¬ á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸á€‘á€Šá€·á€ºá€•á€«';
            errorDiv.style.display = 'block';
            return;
        }

        // âŒ Stock Removed
        /*
        if (isNaN(stock) || stock < 0) {
           errorDiv.textContent = 'á€™á€¾á€”á€ºá€€á€”á€ºá€á€±á€¬ á€œá€€á€ºá€€á€»á€”á€ºá€¡á€›á€±á€¡á€á€½á€€á€º (Stock) á€‘á€Šá€·á€ºá€•á€«';
           errorDiv.style.display = 'block';
           return;
       }
       */

        const finalImage = currentModalImageBase64 || NO_IMAGE_PLACEHOLDER;
        const categoryName = getCategoryName(categoryId);

        if (currentEditingProductId) {
            const index = products.findIndex(p => p.id === currentEditingProductId);
            if (index !== -1) {
                products[index] = {
                    id: currentEditingProductId,
                    name,
                    price,
                    // âŒ stock removed
                    category: categoryId,
                    categoryName,
                    image: finalImage
                };
            }
        } else {
            const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
            products.push({
                id: newId,
                name,
                price,
                stock: 999999, // âŒ Stock removed, setting a dummy value
                category: categoryId,
                categoryName,
                image: finalImage
            });
        }

        saveData();
        renderProductsTable();
        renderPOSProducts();
        closeProductModal(true);
    }

    // ==================== POS Product List (POS Tab - Enhanced UI) ====================
    function renderPOSProducts() {
        const grid = document.getElementById('posProductGrid');
        grid.innerHTML = '';

        const filterCategoryId = parseInt(document.getElementById('posCategoryFilter').value);
        const searchTerm = document.getElementById('posProductSearch').value.toLowerCase();

        const filteredProducts = products.filter(p => {
            const matchesCategory = filterCategoryId === 1 || p.category === filterCategoryId;
            const matchesSearch = p.name.toLowerCase().includes(searchTerm);
            return matchesCategory && matchesSearch;
        });

        if (filteredProducts.length === 0) {
            grid.innerHTML = '<div style="text-align: center; color: var(--text-light); padding: 20px;">á€•á€…á€¹á€…á€Šá€ºá€¸á€™á€›á€¾á€­á€•á€« (á€á€­á€¯á€·) á€›á€¾á€¬á€–á€½á€±á€™á€¾á€¯á€”á€¾á€„á€·á€ºá€™á€€á€­á€¯á€€á€ºá€Šá€®á€•á€«</div>';
            return;
        }

        filteredProducts.forEach(product => {
            const item = document.createElement('div');
            item.className = 'product-item';

            // âŒ Stock check removed - always clickable
            item.onclick = () => addToCart(product);


            const imageSrc = product.image && product.image !== NO_IMAGE_PLACEHOLDER ? product.image : NO_IMAGE_PLACEHOLDER;
            const hasImage = !!imageSrc;

            if (!hasImage) {
                item.classList.add('no-image');
            }

            item.innerHTML = `
                ${hasImage ? `<img src="${imageSrc}" alt="${product.name}" onerror="this.classList.add('hidden'); this.parentNode.classList.add('no-image');">` : ''}
                <div class="product-name" title="${product.name}">${product.name}</div>
                <div class="product-price">${formatCurrency(product.price, false)}</div>
            `;
            grid.appendChild(item);
        });
    }

    // ==================== POS Cart Management & Calculation (REVISED) ====================
    function addToCart(product) {
        openNumberPad(false); // Close number pad when adding item
        const existingItem = cart.find(item => item.id === product.id);
        const currentProduct = products.find(p => p.id === product.id);

        if (!currentProduct) return;

        let newQty = 1;
        if (existingItem) {
            existingItem.qty++;
            newQty = existingItem.qty;
        } else {
            cart.push({
                id: currentProduct.id,
                name: currentProduct.name,
                price: currentProduct.price,
                image: currentProduct.image,
                // âŒ stock removed
                category: currentProduct.category,
                qty: 1,
            });
            newQty = 1;
        }

        renderCart(product.name, newQty); // GEMINI ADDITION: Pass product name and NEW QTY to show toast
    }

    function renderCart(productName = null, newQty = null) {
        const cartItems = document.getElementById('cartItems');

        if (cart.length === 0) {
            cartItems.innerHTML = '<div class="empty-cart" style="text-align: center; color: var(--text-light); padding: 15px 0;">á€…á€»á€±á€¸á€á€šá€ºá€á€¼á€„á€ºá€¸á€™á€›á€¾á€­á€á€±á€¸á€•á€«</div>';
            calculateTotals();
            updateNavCartCount(); // GEMINI ADDITION: Update Cart Counter
            openNumberPad(false); // Close pad if cart is cleared
            return;
        }

        cartItems.innerHTML = '';

        cart.forEach(item => {
            const itemTotal = item.qty * item.price;
            const cartItem = document.createElement('div');
            cartItem.className = 'cart-item';
            
            // ğŸ’¡ á€á€±á€¬á€„á€ºá€¸á€†á€­á€¯á€á€»á€€á€ºá€¡á€› á€•á€¼á€„á€ºá€†á€„á€ºá€á€¼á€„á€ºá€¸ - Qnty á€•á€«á€á€„á€ºá€á€±á€¬ á€”á€±á€›á€¬á€€á€­á€¯ Message Display á€¡á€–á€¼á€…á€º á€á€¯á€¶á€¸á€á€¼á€„á€ºá€¸ (á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º) Name á€¡á€±á€¬á€€á€ºá€á€½á€„á€º Qnty á€€á€­á€¯ á€‘á€Šá€·á€ºá€•á€±á€¸á€á€¼á€„á€ºá€¸
            // Name á€¡á€±á€¬á€€á€ºá€á€½á€„á€º Price á€”á€¾á€„á€·á€º Qty á€€á€­á€¯ á€•á€±á€«á€„á€ºá€¸á€‘á€Šá€·á€ºá€•á€±á€¸á€œá€­á€¯á€€á€ºá€á€Šá€ºá‹
            cartItem.innerHTML = `
                <div class="cart-item-details">
                    <div class="cart-item-name">${item.name}</div>
                    <div class="cart-item-price-qnty">@ ${formatCurrency(item.price, false)} / Qty: ${item.qty}</div>
                </div>
                <div class="qty-controls">
                    <button class="qty-btn" onclick="updateQty(${item.id}, -1)">-</button>
                    <span class="item-qty">${item.qty}</span>
                    <button class="qty-btn" onclick="updateQty(${item.id}, 1)">+</button>
                </div>
                <div class="cart-item-total">${formatCurrency(itemTotal, false)}</div>
                <button class="action-icon delete-icon" style="font-size: 14px;" onclick="removeItem(${item.id})" title="á€–á€»á€€á€ºá€™á€Šá€º">
                    &#10005;
                </button>
            `;
            cartItems.appendChild(cartItem);
        });

        calculateTotals();
        updateNavCartCount(); // GEMINI ADDITION: Update Cart Counter

        // GEMINI ADDITION: Show Toast Message on add/update
        if (productName && newQty) {
            showToastMessage(productName, newQty);
        }
        // END GEMINI ADDITION
    }

    function updateQty(id, delta) {
        openNumberPad(false); // Close number pad when updating qty
        const item = cart.find(i => i.id === id);

        if (item) {
            // âŒ Stock check removed

            item.qty += delta;
            const newQty = item.qty; // Store new quantity for the toast message

            if (item.qty <= 0) {
                cart = cart.filter(i => i.id !== id);
                renderCart();
            } else {
                renderCart(item.name, newQty);
            }
        }
    }

    function removeItem(id) {
        openNumberPad(false); // Close number pad when removing item
        cart = cart.filter(i => i.id !== id);
        renderCart();
    }

    function clearCart() {
        if (cart.length === 0) return;

        if (confirm('á€…á€»á€±á€¸á€á€¼á€„á€ºá€¸á€¡á€¬á€¸á€œá€¯á€¶á€¸á€€á€­á€¯ á€–á€»á€€á€ºá€™á€Šá€ºá€™á€¾á€¬ á€á€±á€á€»á€¬á€•á€«á€á€œá€¬á€¸?')) {
            cart = [];
            // Only reset the input value to empty string/placeholder, not '0'
            document.getElementById('discount_percent').value = '';
            document.getElementById('cash').value = '';
            renderCart();
            openNumberPad(false); // Close pad
        }
    }

    function setCashAmount(amount) {
        openNumberPad(false); // Close pad when using quick cash
        const cashInput = document.getElementById('cash');

        const subtotal = cart.reduce((sum, item) => sum + (item.qty * item.price), 0);
        const discountPercent = parseFloat(document.getElementById('discount_percent').value) || 0;
        const discountAmount = Math.round(subtotal * (discountPercent / 100));
        const total = Math.round(Math.max(0, subtotal - discountAmount));

        if (amount === 'auto') {

            if (total === 0) {
                cashInput.value = '';
                calculateTotals();
                return;
            }

            let roundedAmount = 0;
            if (total <= 1000) {
                roundedAmount = Math.ceil(total / 100) * 100;
            } else if (total <= 5000) {
                roundedAmount = Math.ceil(total / 500) * 500;
            } else {
                roundedAmount = Math.ceil(total / 1000) * 1000;
            }

            cashInput.value = Math.max(total, roundedAmount);

        } else {
            cashInput.value = amount;
        }

        calculateTotals();
    }


    function calculateTotals() {
        const subtotal = cart.reduce((sum, item) => sum + (item.qty * item.price), 0);
        const discountInput = document.getElementById('discount_percent');
        const cashInput = document.getElementById('cash');

        // Value is empty string if user cleared it. Treat empty string as 0 for calculation.
        let discountPercent = parseFloat(discountInput.value) || 0;
        let cash = parseFloat(cashInput.value) || 0;

        if (discountPercent < 0) { discountPercent = 0; discountInput.value = ''; }
        if (discountPercent > 100) { discountPercent = 100; discountInput.value = '100'; }
        // We allow cash to be less than 0 or empty string which will be treated as 0 here


        const discountAmount = Math.round(subtotal * (discountPercent / 100));
        const total = Math.round(Math.max(0, subtotal - discountAmount));
        const change = Math.round(Math.max(0, cash - total));

        // Update Cart Summary UI/UX
        document.getElementById('subtotal').textContent = formatCurrency(subtotal, false);
        document.getElementById('discount-display').textContent = formatCurrency(discountAmount, false) + (discountPercent > 0 ? ` (${discountPercent}%)` : '');
        document.getElementById('total').textContent = formatCurrency(total, false);

        document.getElementById('cash-display').textContent = formatCurrency(cash, false);
        document.getElementById('change').textContent = formatCurrency(change, false);
    }

    function saveOrder(isPrint = false) {
        openNumberPad(false); // Close pad before saving

        if (cart.length === 0) {
            alert('á€á€­á€™á€ºá€¸á€›á€”á€º á€…á€»á€±á€¸á€á€¼á€„á€ºá€¸á€á€½á€„á€º á€•á€…á€¹á€…á€Šá€ºá€¸á€™á€›á€¾á€­á€•á€«!');
            return null;
        }

        const subtotal = cart.reduce((sum, item) => sum + (item.qty * item.price), 0);
        // Get value directly from input, treat empty string as 0
        const discountPercent = parseFloat(document.getElementById('discount_percent').value) || 0;
        const discountAmount = Math.round(subtotal * (discountPercent / 100));
        const total = Math.round(subtotal - discountAmount);
        const cash = parseFloat(document.getElementById('cash').value) || 0;

        if (total > 0 && cash < total) {
            alert('á€•á€±á€¸á€„á€½á€± (Cash) á€á€Šá€º á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸ (Total) á€‘á€€á€º á€™á€”á€Šá€ºá€¸á€›á€•á€«á‹');
            return null;
        }

        // âŒ Stock Update logic removed

        // Generate new ID and save
        const newSale = {
            invoiceId: invoiceNumber,
            dateTime: new Date().toISOString(),
            subtotal: subtotal,
            discount: discountAmount,
            discountPercent: discountPercent,
            total: total,
            cash: cash,
            change: Math.max(0, cash - total),
            items: JSON.parse(JSON.stringify(cart))
        };

        salesHistory.push(newSale);
        invoiceNumber++;
        saveData();

        if (!isPrint) {
            alert(`á€˜á€±á€¬á€„á€ºá€á€»á€¬á€”á€¶á€•á€«á€á€º ${formatInvoiceNumber(newSale.invoiceId)} á€–á€¼á€„á€·á€º á€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹`);
        }

        renderProductsTable();
        renderPOSProducts();

        clearCart();
        // IMPORTANT: Clear inputs to empty string for proper UX after clearing cart
        document.getElementById('discount_percent').value = '';
        document.getElementById('cash').value = '';

        renderDashboard();
        renderReportsTable();
        document.getElementById('currentInvNumber').textContent = formatInvoiceNumber(invoiceNumber);

        return newSale;
    }

    function printReceipt() {
        if (cart.length === 0) {
            alert('á€˜á€±á€¬á€„á€ºá€á€»á€¬á€‘á€¯á€á€ºá€›á€”á€º á€…á€»á€±á€¸á€á€¼á€„á€ºá€¸á€á€½á€„á€º á€•á€…á€¹á€…á€Šá€ºá€¸á€™á€›á€¾á€­á€•á€«!');
            return;
        }

        const savedSale = saveOrder(true);
        if (!savedSale) return;

        generateAndPrintReceipt(savedSale);

        // ğŸ’¡ á€á€±á€¬á€„á€ºá€¸á€†á€­á€¯á€á€»á€€á€ºá€¡á€› á€˜á€±á€¬á€„á€ºá€á€»á€¬á€‘á€¯á€á€ºá€•á€¼á€®á€¸á€”á€±á€¬á€€á€º Cart á€€á€­á€¯ á€›á€¾á€„á€ºá€¸á€•á€±á€¸á€á€¼á€„á€ºá€¸ (saveOrder á€á€½á€„á€º á€•á€«á€•á€¼á€®á€¸á€–á€¼á€…á€ºá€á€±á€¬á€ºá€œá€Šá€ºá€¸ á€›á€¾á€„á€ºá€¸á€œá€„á€ºá€¸á€™á€¾á€¯á€¡á€á€½á€€á€º á€‘á€•á€ºá€™á€¶á€›á€±á€¸á€á€¬á€¸á€á€¼á€„á€ºá€¸)
        // clearCart(); // saveOrder(true) á€‘á€²á€á€½á€„á€º á€•á€«á€•á€¼á€®á€¸á€á€¬á€¸
    }

    function generateAndPrintReceipt(sale) {
        const size = settings.receiptSize;
        const sizeMM = size === '80mm' ? '80mm' : '58mm';

        let receiptContent = `
        <div style="text-align: center;">
            <p style="font-size: 14px; font-weight: bold;">${settings.shopName}</p>
            <p style="font-size: 10px;">${settings.shopAddress}</p>
            <p style="font-size: 10px;">Tel: ${settings.shopPhone}</p>
        </div>
        <hr style="border-top: 1px dashed #000; margin: 5px 0;">
        <p style="font-size: 10px; margin: 2px 0;">á€˜á€±á€¬á€„á€ºá€á€»á€¬: ${formatInvoiceNumber(sale.invoiceId)}</p>
        <p style="font-size: 10px; margin: 2px 0;">á€›á€€á€ºá€…á€½á€²: ${getFormattedDateTime(sale.dateTime)}</p>
        <hr style="border-top: 1px dashed #000; margin: 5px 0;">

        <table style="width: 100%; border-collapse: collapse; font-size: 10px;">
            <thead>
                <tr>
                    <th style="text-align: left; padding: 2px 0; width: 50%;">á€•á€…á€¹á€…á€Šá€ºá€¸</th>
                    <th style="text-align: center; padding: 2px 0; width: 15%;">Qty</th>
                    <th style="text-align: right; padding: 2px 0; width: 35%;">Amount</th>
                </tr>
            </thead>
            <tbody>
    `;

        sale.items.forEach(item => {
            receiptContent += `
            <tr>
                <td style="text-align: left; padding: 2px 0;">
                    ${item.name}
                    <div style="font-size: 8px;">@ ${formatCurrency(item.price, false)}</div>
                </td>
                <td style="text-align: center; padding: 2px 0;">${item.qty}</div>
                <td style="text-align: right; padding: 2px 0;">${formatCurrency(item.qty * item.price, false)}</td>
            </tr>
        `;
        });

        receiptContent += `
            </tbody>
        </table>
        <hr style="border-top: 1px dashed #000; margin: 5px 0;">
        <div style="font-size: 11px;">
            <div style="display: flex; justify-content: space-between; padding: 2px 0;">
                <span style="font-weight: normal;">Subtotal :</span>
                <span style="font-weight: bold;">${formatCurrency(sale.subtotal, false)}</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 2px 0; border-bottom: 1px dashed #000; margin-bottom: 5px;">
                <span style="font-weight: normal;">Discount (${sale.discountPercent}%) :</span>
                <span style="font-weight: bold;">${formatCurrency(sale.discount, false)}</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 2px 0; font-size: 14px;">
                <span style="font-weight: bold;">Total. :</span>
                <span style="font-weight: bold;">${formatCurrency(sale.total, false)}</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 2px 0;">
                <span style="font-weight: normal;">Cash :</span>
                <span style="font-weight: bold;">${formatCurrency(sale.cash, false)}</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 2px 0;">
                <span style="font-weight: normal;">Change :</span>
                <span style="font-weight: bold;">${formatCurrency(sale.change, false)}</span>
            </div>
        </div>
        <hr style="border-top: 1px dashed #000; margin: 5px 0;">
        <div style="text-align: center; margin-top: 10px; font-size: 10px;">
            <p>${settings.receiptThankYou}</p>
        </div>
    `;

        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>á€˜á€±á€¬á€„á€ºá€á€»á€¬</title>
            <style>
                @page { size: ${sizeMM} auto; margin: 0; }
                body {
                    width: ${sizeMM};
                    margin: 0;
                    padding: 5px;
                    font-size: 10px;
                    font-family: 'Noto Sans Myanmar', sans-serif, monospace;
                    line-height: 1.2;
                }
                table { width: 100%; border-collapse: collapse; }
                th, td { padding: 3px 0; }
                hr { border: none; border-top: 1px dashed #000; margin: 5px 0; }
            </style>
        </head>
        <body>${receiptContent}</body>
        </html>
    `);
        printWindow.document.close();

        setTimeout(() => {
            printWindow.print();
            printWindow.close();
        }, 500);
    }


    function calculateTodaySales() {
        const todayDateStr = getTodayDateString();
        let todayTotalSales = 0;

        salesHistory.forEach(sale => {
            const saleDatePart = sale.dateTime.split('T')[0];

            if (saleDatePart === todayDateStr) {
                todayTotalSales += sale.total;
            }
        });

        return todayTotalSales;
    }


    // ==================== Dashboard Functions (UPDATED) ====================
    function filterSalesByDateRange(startDateStr, endDateStr) {
        if (!startDateStr || !endDateStr) {
            return salesHistory;
        }

        const startDateObj = getDateOnly(startDateStr);
        const endDateObj = getDateOnly(endDateStr);

        if (!startDateObj || !endDateObj) return [];

        const inclusiveEndDateObj = new Date(endDateObj.getTime());
        inclusiveEndDateObj.setUTCDate(inclusiveEndDateObj.getUTCDate() + 1);

        return salesHistory.filter(sale => {
            const saleDate = new Date(sale.dateTime);
            const saleDateOnly = new Date(Date.UTC(saleDate.getFullYear(), saleDate.getMonth(), saleDate.getDate()));

            return (saleDateOnly >= startDateObj && saleDateOnly < inclusiveEndDateObj);
        });
    }

    function renderDashboard() {
        const startDateStr = document.getElementById('dashboardRangeStartDate').value;
        const endDateStr = document.getElementById('dashboardRangeEndDate').value;

        const filteredSales = filterSalesByDateRange(startDateStr, endDateStr);

        const totalSales = filteredSales.reduce((sum, sale) => sum + sale.total, 0);
        const totalReceipts = filteredSales.length;
        const totalQuantity = filteredSales.reduce((sum, sale) => sum + sale.items.reduce((itemSum, item) => itemSum + item.qty, 0), 0);
        const totalDiscount = filteredSales.reduce((sum, sale) => sum + sale.discount, 0);

        const todaySales = calculateTodaySales();

        document.getElementById('todayTotalSales').textContent = formatCurrency(todaySales, false);
        document.getElementById('dailyTotalSales').textContent = formatCurrency(totalSales, false);
        document.getElementById('dailyTotalDiscount').textContent = formatCurrency(totalDiscount, false);
        document.getElementById('dailyTotalReceipts').textContent = totalReceipts + ' á€á€¯';
        document.getElementById('dailyTotalQuantity').textContent = totalQuantity + ' á€á€¯';

        renderDashboardProductSummary();
    }

    function renderDashboardProductSummary() {
        const tableBody = document.getElementById('dashboardProductSummaryTable');
        tableBody.innerHTML = '';

        const startDateStr = document.getElementById('dashboardRangeStartDate').value;
        const endDateStr = document.getElementById('dashboardRangeEndDate').value;
        const productNameSearch = document.getElementById('dashboardProductNameSearch').value.toLowerCase();

        const filteredSales = filterSalesByDateRange(startDateStr, endDateStr);

        const productSales = {};

        filteredSales.forEach(sale => {
            sale.items.forEach(item => {
                if (item.name.toLowerCase().includes(productNameSearch)) {
                    if (!productSales[item.name]) {
                        productSales[item.name] = {
                            name: item.name,
                            qty: 0,
                            total: 0,
                            price: item.price,
                            firstSaleDate: sale.dateTime.split('T')[0]
                        };
                    }
                    productSales[item.name].qty += item.qty;
                    productSales[item.name].total += (item.qty * item.price);

                    if (new Date(sale.dateTime) < new Date(productSales[item.name].firstSaleDate)) {
                        productSales[item.name].firstSaleDate = sale.dateTime.split('T')[0];
                    }
                }
            });
        });

        const sortedSales = Object.values(productSales).sort((a, b) => b.total - a.total);

        if (sortedSales.length === 0) {
            tableBody.innerHTML = `
          <tr>
            <td colspan="5" style="text-align:center; padding:20px; color:var(--text-light);">
              á€›á€±á€¬á€„á€ºá€¸á€¡á€¬á€¸á€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€›á€¾á€­á€á€±á€¸á€•á€« (á€á€­á€¯á€·) á€…á€…á€ºá€‘á€¯á€á€ºá€™á€¾á€¯á€”á€¾á€„á€·á€ºá€™á€€á€­á€¯á€€á€ºá€Šá€®á€•á€«
            </td>
          </tr>
        `;
            return;
        }

        sortedSales.forEach(sale => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
            <td>${sale.firstSaleDate}</td>
            <td>${sale.name}</td>
            <td>${formatCurrency(sale.price, false)}</td>
            <td>${sale.qty}</td>
            <td>${formatCurrency(sale.total, false)}</td>
        `;
            tableBody.appendChild(tr);
        });
    }

    function exportDashboardSummaryToExcel() {
        const startDateStr = document.getElementById('dashboardRangeStartDate').value || 'ALL';
        const endDateStr = document.getElementById('dashboardRangeEndDate').value || 'ALL';
        const productNameSearch = document.getElementById('dashboardProductNameSearch').value.toLowerCase();

        const filteredSales = filterSalesByDateRange(startDateStr, endDateStr);

        const header = ["Date", "Name", "Price (MMK)", "Qty", "Total (Item MMK)"];

        const data = [
            ["Dashboard Detailed Sales Report"],
            ["Report Date Range:", `${startDateStr} to ${endDateStr}`],
            ["Total Sales (Range):", document.getElementById('dailyTotalSales').textContent.replace(' á€€á€»á€•á€º', '').replace(/,/g, '')],
            ["Total Discount (Range):", document.getElementById('dailyTotalDiscount').textContent.replace(' á€€á€»á€•á€º', '').replace(/,/g, '')],
            [],
            header
        ];

        filteredSales.forEach(sale => {
            const saleDate = sale.dateTime.split('T')[0];
            sale.items.forEach(item => {
                if (item.name.toLowerCase().includes(productNameSearch)) {
                    data.push([
                        saleDate,
                        `"${item.name.replace(/"/g, '""')}"`,
                        item.price.toString(),
                        item.qty.toString(),
                        (item.qty * item.price).toString()
                    ]);
                }
            });
        });

        if (data.length <= 6) {
            alert("Excel á€‘á€¯á€á€ºá€›á€”á€ºá€¡á€á€½á€€á€º á€…á€…á€ºá€‘á€¯á€á€ºá€‘á€¬á€¸á€á€±á€¬ á€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€»á€¬á€¸á€™á€›á€¾á€­á€•á€«á‹");
            return;
        }

        const csvContent = data.map(e => e.join(",")).join("\n");

        const blob = new Blob([`\ufeff${csvContent}`], {
            type: 'text/csv;charset=utf-8;'
        });

        const filename = `Dashboard_Sales_Detail_${startDateStr}_to_${endDateStr}.csv`;

        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(a.href);

        alert("Dashboard á€¡á€›á€±á€¬á€„á€ºá€¸á€¡á€á€±á€¸á€…á€­á€á€ºá€€á€­á€¯ Excel á€–á€­á€¯á€„á€ºá€¡á€–á€¼á€…á€º Download á€…á€á€„á€ºá€”á€±á€•á€«á€•á€¼á€®á‹");
    }


    // ==================== Reports Functions (FIXED) ====================
    function renderReportsTable() {
        const tableBody = document.getElementById('reportsTableBody');
        tableBody.innerHTML = '';

        const startDateStr = document.getElementById('reportStartDate').value;
        const endDateStr = document.getElementById('reportEndDate').value;
        const productNameSearch = document.getElementById('reportProductNameSearch').value.toLowerCase();

        let filteredItems = [];
        let totalQty = 0;
        let totalSales = 0;

        const filteredSales = filterSalesByDateRange(startDateStr, endDateStr);

        filteredSales.forEach(sale => {
            sale.items.forEach((item, itemIndex) => {
                const invoiceStr = formatInvoiceNumber(sale.invoiceId);
                if (item.name.toLowerCase().includes(productNameSearch) || invoiceStr.includes(productNameSearch)) {

                    filteredItems.push({
                        invoiceId: sale.invoiceId,
                        dateTime: sale.dateTime,
                        name: item.name,
                        price: item.price,
                        qty: item.qty,
                        itemTotal: item.qty * item.price,
                        discount: sale.discount,
                        discountPercent: sale.discountPercent,
                        totalSale: sale.total
                    });

                    totalQty += item.qty;
                    totalSales += (item.qty * item.price);
                }
            });
        });

        if (filteredItems.length === 0) {
            tableBody.innerHTML = `
          <tr>
            <td colspan="7" style="text-align:center; padding:20px; color:var(--text-light);">
              á€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€›á€¾á€­á€•á€« (á€á€­á€¯á€·) á€›á€¾á€¬á€–á€½á€±á€™á€¾á€¯á€”á€¾á€„á€·á€ºá€™á€€á€­á€¯á€€á€ºá€Šá€®á€•á€«
            </td>
          </tr>
        `;
        } else {
            filteredItems.sort((a, b) => b.invoiceId - a.invoiceId);

            filteredItems.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
              <td>${getFormattedDateTime(item.dateTime)}</td>
              <td>${formatInvoiceNumber(item.invoiceId)}</td>
              <td>${item.name}</td>
              <td>${formatCurrency(item.price, false)}</td>
              <td>${item.qty}</td>
              <td>${formatCurrency(item.itemTotal, false)}</td>
              <td>
                <button class="action-icon receipt-icon" title="á€˜á€±á€¬á€„á€ºá€á€»á€¬á€•á€¼á€”á€ºá€‘á€¯á€á€ºá€™á€Šá€º" onclick="viewReceipt(${item.invoiceId})" style="color: var(--info);">
                    ğŸ§¾
                </button>
                <button class="action-icon delete-icon" title="á€˜á€±á€¬á€„á€ºá€á€»á€¬á€–á€»á€€á€ºá€™á€Šá€º" onclick="deleteSaleByInvoice(${item.invoiceId})" style="color: var(--danger);">
                    &#128465;
                </button>
              </td>
            `;
                tableBody.appendChild(tr);
            });
        }

        document.getElementById('reportTotalQty').textContent = totalQty;
        document.getElementById('reportTotalSales').textContent = formatCurrency(totalSales, false);
    }

    function deleteSaleByInvoice(invoiceId) {
        if (confirm(`á€˜á€±á€¬á€„á€ºá€á€»á€¬á€”á€¶á€•á€«á€á€º ${formatInvoiceNumber(invoiceId)} á€€á€­á€¯ á€–á€»á€€á€ºá€™á€¾á€¬á€á€±á€á€»á€¬á€•á€«á€á€œá€¬á€¸?`)) {

            const saleToDelete = salesHistory.find(sale => sale.invoiceId === invoiceId);
            if (saleToDelete) {
                // âŒ Stock logic removed
                /*
                saleToDelete.items.forEach(item => {
                   const product = products.find(p => p.id === item.id);
                   if (product && product.category !== 6) {
                       product.stock += item.qty;
                   }
                });
                */
            }

            salesHistory = salesHistory.filter(sale => sale.invoiceId !== invoiceId);
            saveData();
            renderReportsTable();
            renderDashboard();
            renderProductsTable();
            alert('á€˜á€±á€¬á€„á€ºá€á€»á€¬á€–á€»á€€á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹'); // âŒ 'á€œá€€á€ºá€€á€»á€”á€ºá€•á€…á€¹á€…á€Šá€ºá€¸á€™á€»á€¬á€¸ á€•á€¼á€”á€ºá€œá€Šá€ºá€–á€¼á€Šá€·á€ºá€á€½á€„á€ºá€¸á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹' á€…á€¬á€á€¬á€¸á€€á€­á€¯á€–á€šá€ºá€œá€­á€¯á€€á€ºá€•á€«á€•á€¼á€®
        }
    }

    function viewReceipt(invoiceId) {
        const sale = salesHistory.find(s => s.invoiceId === invoiceId);
        if (sale) {
            generateAndPrintReceipt(sale);
        } else {
            alert('á€˜á€±á€¬á€„á€ºá€á€»á€¬á€”á€¶á€•á€«á€á€º á€™á€á€½á€±á€·á€•á€«á‹');
        }
    }

    function deleteSalesByDate() {
        const startDateStr = document.getElementById('reportStartDate').value;
        const endDateStr = document.getElementById('reportEndDate').value;

        if (!startDateStr || !endDateStr) {
            alert("á€–á€»á€€á€ºá€œá€­á€¯á€á€±á€¬ á€›á€€á€ºá€…á€½á€² á€¡á€…á€”á€¾á€„á€·á€º á€¡á€†á€¯á€¶á€¸á€€á€­á€¯ á€›á€½á€±á€¸á€á€»á€šá€ºá€•á€±á€¸á€•á€«á‹");
            return;
        }

        if (confirm(`á€›á€€á€ºá€…á€½á€² ${startDateStr} á€™á€¾ ${endDateStr} á€¡á€á€½á€„á€ºá€¸á€›á€¾á€­ á€¡á€›á€±á€¬á€„á€ºá€¸á€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€»á€¬á€¸ á€¡á€¬á€¸á€œá€¯á€¶á€¸á€€á€­á€¯ á€–á€»á€€á€ºá€™á€¾á€¬ á€á€±á€á€»á€¬á€•á€«á€á€œá€¬á€¸? á€¤á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€á€»á€€á€ºá€€á€­á€¯ á€•á€¼á€”á€ºá€œá€Šá€ºá€•á€¼á€„á€ºá€†á€„á€ºáá€™á€›á€•á€«á‹`)) {

            const startDateObj = getDateOnly(startDateStr);
            const endDateObj = getDateOnly(endDateStr);
            const inclusiveEndDateObj = new Date(endDateObj.getTime());
            inclusiveEndDateObj.setUTCDate(inclusiveEndDateObj.getUTCDate() + 1);

            const originalLength = salesHistory.length;

            const salesToKeep = [];
            const salesToDelete = [];

            salesHistory.forEach(sale => {
                const saleDate = new Date(sale.dateTime);
                const saleDateOnly = new Date(Date.UTC(saleDate.getFullYear(), saleDate.getMonth(), saleDate.getDate()));

                if (saleDateOnly >= startDateObj && saleDateOnly < inclusiveEndDateObj) {
                    salesToDelete.push(sale);
                } else {
                    salesToKeep.push(sale);
                }
            });

            salesToDelete.forEach(sale => {
                // âŒ Stock logic removed
                /*
                sale.items.forEach(item => {
                   const product = products.find(p => p.id === item.id);
                   if (product && product.category !== 6) {
                       product.stock += item.qty;
                   }
                });
                */
            });

            salesHistory = salesToKeep;

            saveData();
            renderReportsTable();
            renderDashboard();
            renderProductsTable();
            alert(`${originalLength - salesHistory.length} á€á€¯á€á€±á€¬ á€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€»á€¬á€¸á€€á€­á€¯ á€–á€»á€€á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹`); // âŒ 'á€œá€€á€ºá€€á€»á€”á€ºá€•á€…á€¹á€…á€Šá€ºá€¸á€™á€»á€¬á€¸ á€•á€¼á€”á€ºá€œá€Šá€ºá€–á€¼á€Šá€·á€ºá€á€½á€„á€ºá€¸á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹' á€…á€¬á€á€¬á€¸á€€á€­á€¯á€–á€šá€ºá€œá€­á€¯á€€á€ºá€•á€«á€•á€¼á€®
        }
    }

    function exportReportsToExcel() {
        const tableBody = document.getElementById('reportsTableBody');
        if (tableBody.rows.length === 0 || tableBody.rows[0].cells.length === 1) {
            alert("Excel á€‘á€¯á€á€ºá€›á€”á€ºá€¡á€á€½á€€á€º á€…á€…á€ºá€‘á€¯á€á€ºá€‘á€¬á€¸á€á€±á€¬ á€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€»á€¬á€¸á€™á€›á€¾á€­á€•á€«á‹");
            return;
        }

        const startDateStr = document.getElementById('reportStartDate').value || 'ALL';
        const endDateStr = document.getElementById('reportEndDate').value || 'ALL';
        const productNameSearch = document.getElementById('reportProductNameSearch').value.toLowerCase();

        const filteredSales = filterSalesByDateRange(startDateStr, endDateStr);

        const header = ["Date", "Invoice ID", "Name", "Price (MMK)", "Qty", "Total (Item MMK)"];

        const data = [
            ["Detailed Sales Report (Reports Tab)"],
            ["Report Date Range:", `${startDateStr} to ${endDateStr}`],
            [],
            header
        ];

        filteredSales.forEach(sale => {
            const saleDate = sale.dateTime.split('T')[0];
            const invoiceStr = formatInvoiceNumber(sale.invoiceId);

            sale.items.forEach(item => {
                const itemMatchesSearch = item.name.toLowerCase().includes(productNameSearch);
                const invoiceMatchesSearch = invoiceStr.includes(productNameSearch);

                if (itemMatchesSearch || invoiceMatchesSearch) {
                    data.push([
                        saleDate,
                        invoiceStr,
                        `"${item.name.replace(/"/g, '""')}"`,
                        item.price.toString(),
                        item.qty.toString(),
                        (item.qty * item.price).toString()
                    ]);
                }
            });
        });

        if (data.length <= 4) {
            alert("Excel á€‘á€¯á€á€ºá€›á€”á€ºá€¡á€á€½á€€á€º á€…á€…á€ºá€‘á€¯á€á€ºá€‘á€¬á€¸á€á€±á€¬ á€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€»á€¬á€¸á€™á€›á€¾á€­á€•á€«á‹");
            return;
        }

        const csvContent = data.map(e => e.join(",")).join("\n");

        const blob = new Blob([`\ufeff${csvContent}`], {
            type: 'text/csv;charset=utf-8;'
        });

        const filename = `Sales_Report_Detail_${startDateStr}_to_${endDateStr}.csv`;

        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(a.href);

        alert("á€¡á€›á€±á€¬á€„á€ºá€¸á€¡á€á€±á€¸á€…á€­á€á€ºá€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€»á€¬á€¸ Excel á€–á€­á€¯á€„á€ºá€¡á€–á€¼á€…á€º Download á€…á€á€„á€ºá€”á€±á€•á€«á€•á€¼á€®á‹");
    }

    // ==================== Settings Functions ====================
    function loadSettings() {
        document.getElementById('themeSelect').value = settings.theme || 'light';
        document.getElementById('shopName').value = settings.shopName || '';
        document.getElementById('shopAddress').value = settings.shopAddress || '';
        document.getElementById('shopPhone').value = settings.shopPhone || '';
        document.getElementById('receiptThankYou').value = settings.receiptThankYou || '';
        document.getElementById('receiptSize').value = settings.receiptSize || '80mm';
        document.getElementById('currentInvNumber').textContent = formatInvoiceNumber(invoiceNumber);
    }

    function saveSettings() {
        settings.theme = document.getElementById('themeSelect').value;
        settings.shopName = document.getElementById('shopName').value.trim();
        settings.shopAddress = document.getElementById('shopAddress').value.trim();
        settings.shopPhone = document.getElementById('shopPhone').value.trim();
        settings.receiptThankYou = document.getElementById('receiptThankYou').value.trim();
        settings.receiptSize = document.getElementById('receiptSize').value;

        saveData();
        switchTheme(settings.theme);
        alert("á€†á€­á€¯á€„á€ºá€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€™á€»á€¬á€¸á€€á€­á€¯ á€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹");
    }

    function switchTheme(themeName) {
        const body = document.body;
        body.classList.remove('light-theme', 'dark-theme');
        body.classList.add(`${themeName}-theme`);
        settings.theme = themeName;
        localStorage.setItem('posSettings', JSON.stringify(settings));
    }

    function resetInvoiceNumber() {
        if (confirm("Invoice Number á€€á€­á€¯ 000001 á€™á€¾ á€•á€¼á€”á€ºá€œá€Šá€ºá€…á€á€„á€ºá€™á€¾á€¬ á€á€±á€á€»á€¬á€•á€«á€á€œá€¬á€¸?")) {
            invoiceNumber = 1;
            saveData();
            document.getElementById('currentInvNumber').textContent = formatInvoiceNumber(invoiceNumber);
            alert("Invoice Number á€€á€­á€¯ 000001 á€™á€¾ á€•á€¼á€”á€ºá€œá€Šá€ºá€…á€á€„á€ºá€œá€­á€¯á€€á€ºá€•á€«á€•á€¼á€®á‹");
        }
    }

    // ==================== GEMINI ADDITION: New UX Functions ====================

    /**
     * Cart Icon á€•á€±á€«á€ºá€á€½á€„á€º Cart á€‘á€²á€›á€¾á€­ á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸á€•á€…á€¹á€…á€Šá€ºá€¸ á€¡á€›á€±á€¡á€á€½á€€á€ºá€€á€­á€¯ á€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€•á€¼á€á€á€¼á€„á€ºá€¸á‹
     */
    function updateNavCartCount() {
        const totalItems = cart.reduce((sum, item) => sum + item.qty, 0);
        const cartCountElement = document.getElementById('navCartCount');

        cartCountElement.textContent = totalItems;

        if (totalItems > 0) {
            cartCountElement.style.display = 'block';
        } else {
            cartCountElement.style.display = 'none';
        }
    }

    /**
     * Product á€á€…á€ºá€á€¯ Cart á€‘á€²á€á€­á€¯á€· á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€•á€¼á€®á€¸á€”á€±á€¬á€€á€º á€¡á€á€Šá€ºá€•á€¼á€¯á€™á€€á€ºá€†á€±á€·á€á€»á€ºá€•á€¼á€á€á€¼á€„á€ºá€¸á‹
     * @param {string} productName - Cart á€‘á€²á€á€­á€¯á€· á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€œá€­á€¯á€€á€ºá€á€±á€¬ á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€™á€Šá€ºá‹
     * @param {number} newQty - Cart á€‘á€²á€›á€¾á€­ á€¡á€†á€­á€¯á€•á€«á€•á€…á€¹á€…á€Šá€ºá€¸á á€œá€€á€ºá€›á€¾á€­ Qty
     */
    function showToastMessage(productName, newQty) {
        const toast = document.getElementById('toast-message');
        const toastText = document.getElementById('toast-text');

        // 1. á€™á€€á€ºá€†á€±á€·á€á€»á€ºá€€á€­á€¯ á€•á€¼á€„á€ºá€†á€„á€ºá€á€¼á€„á€ºá€¸ (ğŸ’¡ á€á€±á€¬á€„á€ºá€¸á€†á€­á€¯á€á€»á€€á€ºá€¡á€á€­á€¯á€„á€ºá€¸ Qty á€•á€«á€á€„á€ºá€á€Šá€º)
        toastText.textContent = `${productName} (Qnty: ${newQty}) á€€á€­á€¯ á€á€½á€”á€ºá€¸á€œá€¾á€Šá€ºá€¸á€‘á€² á€‘á€Šá€·á€ºá€œá€­á€¯á€€á€ºá€•á€«á€•á€¼á€®á‹`;

        // 2. á€œá€€á€ºá€›á€¾á€­ timer á€›á€¾á€­á€”á€±á€œá€»á€¾á€„á€º á€›á€¾á€„á€ºá€¸á€•á€…á€ºá€•á€¼á€®á€¸ á€•á€¼á€”á€ºá€…á€á€¼á€„á€ºá€¸
        clearTimeout(toast.timeoutId);

        // 3. á€™á€€á€ºá€†á€±á€·á€á€»á€ºá€€á€­á€¯ á€•á€¼á€á€á€¼á€„á€ºá€¸ (Fade In)
        toast.classList.add('show');

        // 4. á€…á€€á€¹á€€á€”á€·á€ºá€¡á€”á€Šá€ºá€¸á€„á€šá€ºá€€á€¼á€¬á€•á€¼á€®á€¸á€”á€±á€¬á€€á€º á€–á€»á€±á€¬á€€á€ºá€á€¼á€„á€ºá€¸ (Fade Out)
        toast.timeoutId = setTimeout(() => {
            toast.classList.remove('show');
        }, 2500); // 2.5 á€…á€€á€¹á€€á€”á€·á€ºá€€á€¼á€¬á€•á€¼á€®á€¸á€”á€±á€¬á€€á€º á€•á€»á€±á€¬á€€á€ºá€€á€½á€šá€ºá€á€½á€¬á€¸á€•á€«á€™á€Šá€ºá‹
    }


    // ==================== GEMINI ADDITION: Calculator Number Pad Logic ====================

    /**
     * Number Pad Modal á€€á€­á€¯ á€–á€½á€„á€·á€ºá€á€¼á€„á€ºá€¸ á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º á€•á€­á€á€ºá€á€¼á€„á€ºá€¸á‹
     * @param {boolean} shouldOpen - á€–á€½á€„á€·á€ºá€™á€œá€¬á€¸ (true) / á€•á€­á€á€ºá€™á€œá€¬á€¸ (false)
     * @param {string} targetId - á€˜á€šá€º input field á€¡á€á€½á€€á€ºá€œá€² ('cash' or 'discount_percent')
     */
    function openNumberPad(shouldOpen, targetId = null) {
        const modal = document.getElementById('numberPadModal');
        const display = document.getElementById('padDisplay');

        if (shouldOpen && targetId) {
            targetInputId = targetId;
            const currentInput = document.getElementById(targetId);

            // Input á€á€”á€ºá€–á€­á€¯á€¸á€€á€­á€¯ Number Pad á á€™á€»á€€á€ºá€”á€¾á€¬á€•á€¼á€„á€ºá€•á€±á€«á€ºá€á€­á€¯á€· á€šá€°á€œá€¬á€á€¼á€„á€ºá€¸
            let value = currentInput.value.trim() || '0';
            currentNumberPadValue = value;

            // ğŸ’¡ Cash input á€¡á€á€½á€€á€º Total á€á€”á€ºá€–á€­á€¯á€¸á€€á€­á€¯ á€¡á€œá€­á€¯á€¡á€œá€»á€±á€¬á€€á€º á€–á€¼á€Šá€·á€ºá€•á€±á€¸á€á€¼á€„á€ºá€¸ (Total 0 á€™á€Ÿá€¯á€á€ºá€œá€»á€¾á€„á€º)
            if (targetId === 'cash') {
                const totalText = document.getElementById('total').textContent.replace(' á€€á€»á€•á€º', '').replace(/,/g, '');
                const totalValue = parseFloat(totalText) || 0;
                
                // Cash 0 á€–á€¼á€…á€ºá€”á€±á€œá€»á€¾á€„á€º á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º Total á€‘á€€á€º á€”á€Šá€ºá€¸á€”á€±á€œá€»á€¾á€„á€º Total á€€á€­á€¯ á€šá€°á€œá€¬á€•á€±á€¸á€•á€«
                if ((value === '0' || !value) && totalValue > 0) {
                     value = totalValue.toString();
                     currentNumberPadValue = value;
                }
            }


            display.textContent = currentNumberPadValue;
            isNewNumber = true;

            modal.classList.add('active');
            currentInput.blur(); // Input field á€€á€­á€¯ focus á€–á€¼á€¯á€á€ºá€œá€­á€¯á€€á€ºá€á€¼á€„á€ºá€¸ (Keyboard á€•á€±á€«á€ºá€™á€œá€¬á€…á€±á€›á€”á€º)
        } else {
            modal.classList.remove('active');
            targetInputId = '';
        }
    }

    /**
     * Number Pad á á€á€œá€¯á€á€ºá€™á€»á€¬á€¸á€€á€­á€¯ á€”á€¾á€­á€•á€ºá€á€±á€¬á€¡á€á€« á€¡á€œá€¯á€•á€ºá€œá€¯á€•á€ºá€…á€±á€á€±á€¬ Functioná‹
     * @param {string} key - á€”á€¾á€­á€•á€ºá€œá€­á€¯á€€á€ºá€á€±á€¬ á€á€œá€¯á€á€ºá á€á€”á€ºá€–á€­á€¯á€¸ ('1', '.', 'clear', 'apply' á€…á€á€Šá€º)
     */
    function handleNumberPadInput(key) {
        let current = currentNumberPadValue;

        if (key === 'clear') {
            currentNumberPadValue = '0';
            isNewNumber = true;
        } else if (key === 'back') {
            if (current.length > 1 && (current.length > 2 || current !== '0.')) {
                currentNumberPadValue = current.slice(0, -1);
            } else {
                currentNumberPadValue = '0';
                isNewNumber = true;
            }
        } else if (key === 'apply') {
            // 'Apply' á€€á€­á€¯ á€”á€¾á€­á€•á€ºá€œá€»á€¾á€„á€º á€á€€á€ºá€†á€­á€¯á€„á€ºá€›á€¬ input á€‘á€²á€á€­á€¯á€· á€á€”á€ºá€–á€­á€¯á€¸á€‘á€Šá€·á€ºá€•á€¼á€®á€¸ Modal á€€á€­á€¯ á€•á€­á€á€ºá€á€¼á€„á€ºá€¸
            const inputElement = document.getElementById(targetInputId);
            if (inputElement) {
                let finalValue = parseFloat(currentNumberPadValue);

                // Input field á€‘á€²á€™á€¾á€¬ á€á€”á€ºá€–á€­á€¯á€¸ 0 á€–á€¼á€…á€ºá€”á€±á€›á€„á€º á€’á€«á€™á€¾á€™á€Ÿá€¯á€á€º á€™á€á€á€ºá€™á€¾á€á€ºá€›á€á€±á€¸á€›á€„á€º empty string á€‘á€¬á€¸
                if (isNaN(finalValue) || finalValue === 0) {
                    inputElement.value = '';
                } else {
                    // Discount á€¡á€á€½á€€á€º á€€á€”á€·á€ºá€á€á€ºá€á€»á€€á€ºá€…á€…á€º
                    if (targetInputId === 'discount_percent') {
                        finalValue = Math.min(100, Math.max(0, finalValue));
                        inputElement.value = finalValue;
                    } else {
                        // Cash á€¡á€á€½á€€á€º 0 á€‘á€€á€ºá€™á€”á€Šá€ºá€¸á€›
                        finalValue = Math.max(0, finalValue);
                        // Cash á€¡á€á€½á€€á€º á€€á€­á€”á€ºá€¸á€•á€¼á€Šá€·á€ºá€á€¬
                        inputElement.value = Math.round(finalValue);
                    }
                }

                calculateTotals();
            }
            openNumberPad(false);
            return;
        } else if (key === '.') {
            if (!current.includes('.') && targetInputId === 'discount_percent') { // Cash á€¡á€á€½á€€á€º Decimal á€€á€­á€¯ á€€á€¬á€€á€½á€šá€ºá€›á€”á€º
                currentNumberPadValue = current + '.';
                isNewNumber = false;
            } else if (targetInputId === 'cash') {
                 // Cash á€¡á€á€½á€€á€º . á€”á€¾á€­á€•á€ºá€œá€»á€¾á€„á€º á€˜á€¬á€™á€¾ á€™á€œá€¯á€•á€ºá€•á€«
                 return;
            }
        } else { // 0-9 á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º 00
            if (isNewNumber || current === '0') {
                currentNumberPadValue = (key === '00' || key === '0') ? '0' : key;
                isNewNumber = false;
            } else {
                 if (current.includes('.') && key === '00') {
                    // Decimal á€›á€¾á€­á€”á€±á€œá€»á€¾á€„á€º 00 á€€á€­á€¯ 00 á€¡á€–á€¼á€…á€º á€‘á€Šá€·á€ºá€•á€±á€¸á€•á€«
                    currentNumberPadValue += '00';
                 } else if (current.includes('.') && current.split('.')[1].length >= 2) {
                    // Decimal 2 á€”á€±á€›á€¬á€€á€»á€±á€¬á€ºá€œá€»á€¾á€„á€º á€‘á€•á€ºá€™á€‘á€Šá€·á€ºá€•á€« (Discount á€¡á€á€½á€€á€º)
                    return;
                 } else {
                    currentNumberPadValue += key;
                 }
            }
        }

        // Number Pad Display á€á€½á€„á€º á€•á€¼á€á€á€¼á€„á€ºá€¸
        const display = document.getElementById('padDisplay');
        display.textContent = currentNumberPadValue;
    }

    // ==================== END GEMINI ADDITION: Calculator Number Pad Logic ====================


    // Initialize the system
    window.onload = init;


</script>

</body>
</html>
